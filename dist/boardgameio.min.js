!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("react"),require("three")):"function"==typeof define&&define.amd?define(["react","three"],t):(e=e||self).BoardgameIO=t(e.React,e.THREE)}(this,function(e,t){"use strict";var n="default"in e?e.default:e;function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(){return(c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){s(e,t,n[t])})}return e}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function f(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function y(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?d(e):t}function v(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var g=function(e){var t,n=e.Symbol;return"function"==typeof n?n.observable?t=n.observable:(t=n("observable"),n.observable=t):t="@@observable",t}("undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof module?module:Function("return this")()),m=function(){return Math.random().toString(36).substring(7).split("").join(".")},b={INIT:"@@redux/INIT"+m(),REPLACE:"@@redux/REPLACE"+m(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+m()}};function w(e,t,n){var r;if("function"==typeof t&&"function"==typeof n||"function"==typeof n&&"function"==typeof arguments[3])throw new Error("It looks like you are passing several store enhancers to createStore(). This is not supported. Instead, compose them together to a single function.");if("function"==typeof t&&void 0===n&&(n=t,t=void 0),void 0!==n){if("function"!=typeof n)throw new Error("Expected the enhancer to be a function.");return n(w)(e,t)}if("function"!=typeof e)throw new Error("Expected the reducer to be a function.");var o=e,i=t,a=[],s=a,c=!1;function u(){s===a&&(s=a.slice())}function l(){if(c)throw new Error("You may not call store.getState() while the reducer is executing. The reducer has already received the state as an argument. Pass it down from the top reducer instead of reading it from the store.");return i}function p(e){if("function"!=typeof e)throw new Error("Expected the listener to be a function.");if(c)throw new Error("You may not call store.subscribe() while the reducer is executing. If you would like to be notified after the store has been updated, subscribe from a component and invoke store.getState() in the callback to access the latest state. See https://redux.js.org/api-reference/store#subscribe(listener) for more details.");var t=!0;return u(),s.push(e),function(){if(t){if(c)throw new Error("You may not unsubscribe from a store listener while the reducer is executing. See https://redux.js.org/api-reference/store#subscribe(listener) for more details.");t=!1,u();var n=s.indexOf(e);s.splice(n,1)}}}function h(e){if(!function(e){if("object"!=typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}(e))throw new Error("Actions must be plain objects. Use custom middleware for async actions.");if(void 0===e.type)throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(c)throw new Error("Reducers may not dispatch actions.");try{c=!0,i=o(i,e)}finally{c=!1}for(var t=a=s,n=0;n<t.length;n++){(0,t[n])()}return e}return h({type:b.INIT}),(r={dispatch:h,subscribe:p,getState:l,replaceReducer:function(e){if("function"!=typeof e)throw new Error("Expected the nextReducer to be a function.");o=e,h({type:b.REPLACE})}})[g]=function(){var e,t=p;return(e={subscribe:function(e){if("object"!=typeof e||null===e)throw new TypeError("Expected the observer to be an object.");function n(){e.next&&e.next(l())}return n(),{unsubscribe:t(n)}}})[g]=function(){return this},e},r}function k(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function x(e,t){var n=Object.keys(e);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(e)),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n}function C(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return 0===t.length?function(e){return e}:1===t.length?t[0]:t.reduce(function(e,t){return function(){return e(t.apply(void 0,arguments))}})}function D(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return function(){var n=e.apply(void 0,arguments),r=function(){throw new Error("Dispatching while constructing your middleware is not allowed. Other middleware would not be applied to this dispatch.")},o={getState:n.getState,dispatch:function(){return r.apply(void 0,arguments)}},i=t.map(function(e){return e(o)});return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?x(n,!0).forEach(function(t){k(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},n,{dispatch:r=C.apply(void 0,i)(n.dispatch)})}}}var E="MAKE_MOVE",O="GAME_EVENT",P="REDO",I="RESET",_="SYNC",M="UNDO",S="UPDATE",A=function(e,t,n,r){return{type:E,payload:{type:e,args:t,playerID:n,credentials:r}}},T=function(e,t,n,r){return{type:O,payload:{type:e,args:t,playerID:n,credentials:r}}},j=function(e,t,n,r){return{type:O,payload:{type:e,args:t,playerID:n,credentials:r},automatic:!0}},R=function(e,t){return{type:_,state:e,log:t,clientOnly:!0}},N=function(e,t){return{type:S,state:e,deltalog:t,clientOnly:!0}},B=function(e){return{type:I,state:e,clientOnly:!0}},z=function(){return{type:M}},L=function(){return{type:P}},F=Object.freeze({makeMove:A,gameEvent:T,automaticGameEvent:j,sync:R,update:N,reset:B,undo:z,redo:L});var q="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function U(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function G(e,t){return e(t={exports:{}},t.exports),t.exports}var H=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,X=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],Y=function(e){var t=e,n=e.indexOf("["),r=e.indexOf("]");-1!=n&&-1!=r&&(e=e.substring(0,n)+e.substring(n,r).replace(/:/g,";")+e.substring(r,e.length));for(var o=H.exec(e||""),i={},a=14;a--;)i[X[a]]=o[a]||"";return-1!=n&&-1!=r&&(i.source=t,i.host=i.host.substring(1,i.host.length-1).replace(/;/g,":"),i.authority=i.authority.replace("[","").replace("]","").replace(/;/g,":"),i.ipv6uri=!0),i},W=1e3,K=60*W,V=60*K,$=24*V,J=365.25*$,Z=function(e,t){t=t||{};var n,r=typeof e;if("string"===r&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!t)return;var n=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return n*J;case"days":case"day":case"d":return n*$;case"hours":case"hour":case"hrs":case"hr":case"h":return n*V;case"minutes":case"minute":case"mins":case"min":case"m":return n*K;case"seconds":case"second":case"secs":case"sec":case"s":return n*W;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}(e);if("number"===r&&!1===isNaN(e))return t.long?Q(n=e,$,"day")||Q(n,V,"hour")||Q(n,K,"minute")||Q(n,W,"second")||n+" ms":function(e){if(e>=$)return Math.round(e/$)+"d";if(e>=V)return Math.round(e/V)+"h";if(e>=K)return Math.round(e/K)+"m";if(e>=W)return Math.round(e/W)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function Q(e,t,n){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}var ee=G(function(e,t){function n(e){var n;function o(){if(o.enabled){var e=o,r=+new Date,i=r-(n||r);e.diff=i,e.prev=n,e.curr=r,n=r;for(var a=new Array(arguments.length),s=0;s<a.length;s++)a[s]=arguments[s];a[0]=t.coerce(a[0]),"string"!=typeof a[0]&&a.unshift("%O");var c=0;a[0]=a[0].replace(/%([a-zA-Z%])/g,function(n,r){if("%%"===n)return n;c++;var o=t.formatters[r];if("function"==typeof o){var i=a[c];n=o.call(e,i),a.splice(c,1),c--}return n}),t.formatArgs.call(e,a),(o.log||t.log||console.log.bind(console)).apply(e,a)}}return o.namespace=e,o.enabled=t.enabled(e),o.useColors=t.useColors(),o.color=function(e){var n,r=0;for(n in e)r=(r<<5)-r+e.charCodeAt(n),r|=0;return t.colors[Math.abs(r)%t.colors.length]}(e),o.destroy=r,"function"==typeof t.init&&t.init(o),t.instances.push(o),o}function r(){var e=t.instances.indexOf(this);return-1!==e&&(t.instances.splice(e,1),!0)}(t=e.exports=n.debug=n.default=n).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){var n;t.save(e),t.names=[],t.skips=[];var r=("string"==typeof e?e:"").split(/[\s,]+/),o=r.length;for(n=0;n<o;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")));for(n=0;n<t.instances.length;n++){var i=t.instances[n];i.enabled=t.enabled(i.namespace)}},t.enabled=function(e){if("*"===e[e.length-1])return!0;var n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=Z,t.instances=[],t.names=[],t.skips=[],t.formatters={}}),te=(ee.coerce,ee.disable,ee.enable,ee.enabled,ee.humanize,ee.instances,ee.names,ee.skips,ee.formatters,G(function(e,t){function n(){var e;try{e=t.storage.debug}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e}(t=e.exports=ee).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(e){var n=this.useColors;if(e[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+e[0]+(n?"%c ":" ")+"+"+t.humanize(this.diff),!n)return;var r="color: "+this.color;e.splice(1,0,r,"color: inherit");var o=0,i=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&(o++,"%c"===e&&(i=o))}),e.splice(i,0,r)},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}},t.load=n,t.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(n())})),ne=(te.log,te.formatArgs,te.save,te.load,te.useColors,te.storage,te.colors,te("socket.io-client:url")),re=function(e,t){var n=e;t=t||"undefined"!=typeof location&&location,null==e&&(e=t.protocol+"//"+t.host);"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?t.protocol+e:t.host+e),/^(https?|wss?):\/\//.test(e)||(ne("protocol-less url %s",e),e=void 0!==t?t.protocol+"//"+e:"https://"+e),ne("parse %s",e),n=Y(e));n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443"));n.path=n.path||"/";var r=-1!==n.host.indexOf(":")?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+r+":"+n.port,n.href=n.protocol+"://"+r+(t&&t.port===n.port?"":":"+n.port),n};var oe=G(function(e){function t(e){if(e)return function(e){for(var n in t.prototype)e[n]=t.prototype[n];return e}(e)}e.exports=t,t.prototype.on=t.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},t.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},t.prototype.off=t.prototype.removeListener=t.prototype.removeAllListeners=t.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,r=this._callbacks["$"+e];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var o=0;o<r.length;o++)if((n=r[o])===t||n.fn===t){r.splice(o,1);break}return this},t.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),n=this._callbacks["$"+e];if(n)for(var r=0,o=(n=n.slice(0)).length;r<o;++r)n[r].apply(this,t);return this},t.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},t.prototype.hasListeners=function(e){return!!this.listeners(e).length}}),ie={}.toString,ae=Array.isArray||function(e){return"[object Array]"==ie.call(e)},se=function(e){return ce&&Buffer.isBuffer(e)||ue&&(e instanceof ArrayBuffer||le(e))},ce="function"==typeof Buffer&&"function"==typeof Buffer.isBuffer,ue="function"==typeof ArrayBuffer,le=function(e){return"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer};var pe=Object.prototype.toString,he="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===pe.call(Blob),fe="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===pe.call(File);var de={deconstructPacket:function(e){var t=[],n=e.data,r=e;return r.data=function e(t,n){if(!t)return t;if(se(t)){var r={_placeholder:!0,num:n.length};return n.push(t),r}if(ae(t)){for(var o=new Array(t.length),i=0;i<t.length;i++)o[i]=e(t[i],n);return o}if("object"==typeof t&&!(t instanceof Date)){var o={};for(var a in t)o[a]=e(t[a],n);return o}return t}(n,t),r.attachments=t.length,{packet:r,buffers:t}},reconstructPacket:function(e,t){return e.data=function e(t,n){if(!t)return t;if(t&&t._placeholder)return n[t.num];if(ae(t))for(var r=0;r<t.length;r++)t[r]=e(t[r],n);else if("object"==typeof t)for(var o in t)t[o]=e(t[o],n);return t}(e.data,t),e.attachments=void 0,e},removeBlobs:function(e,t){var n=0,r=e;!function e(o,i,a){if(!o)return o;if(he&&o instanceof Blob||fe&&o instanceof File){n++;var s=new FileReader;s.onload=function(){a?a[i]=this.result:r=this.result,--n||t(r)},s.readAsArrayBuffer(o)}else if(ae(o))for(var c=0;c<o.length;c++)e(o[c],c,o);else if("object"==typeof o&&!se(o))for(var u in o)e(o[u],u,o)}(r),n||t(r)}},ye=G(function(e,t){var n=te("socket.io-parser");function r(){}t.protocol=4,t.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],t.CONNECT=0,t.DISCONNECT=1,t.EVENT=2,t.ACK=3,t.ERROR=4,t.BINARY_EVENT=5,t.BINARY_ACK=6,t.Encoder=r,t.Decoder=a;var o=t.ERROR+'"encode error"';function i(e){var r=""+e.type;if(t.BINARY_EVENT!==e.type&&t.BINARY_ACK!==e.type||(r+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(r+=e.nsp+","),null!=e.id&&(r+=e.id),null!=e.data){var i=function(e){try{return JSON.stringify(e)}catch(e){return!1}}(e.data);if(!1===i)return o;r+=i}return n("encoded %j as %s",e,r),r}function a(){this.reconstructor=null}function s(e){this.reconPack=e,this.buffers=[]}function c(e){return{type:t.ERROR,data:"parser error: "+e}}r.prototype.encode=function(e,r){(n("encoding packet %j",e),t.BINARY_EVENT===e.type||t.BINARY_ACK===e.type)?function(e,t){de.removeBlobs(e,function(e){var n=de.deconstructPacket(e),r=i(n.packet),o=n.buffers;o.unshift(r),t(o)})}(e,r):r([i(e)])},oe(a.prototype),a.prototype.add=function(e){var r;if("string"==typeof e)r=function(e){var r=0,o={type:Number(e.charAt(0))};if(null==t.types[o.type])return c("unknown packet type "+o.type);if(t.BINARY_EVENT===o.type||t.BINARY_ACK===o.type){for(var i="";"-"!==e.charAt(++r)&&(i+=e.charAt(r),r!=e.length););if(i!=Number(i)||"-"!==e.charAt(r))throw new Error("Illegal attachments");o.attachments=Number(i)}if("/"===e.charAt(r+1))for(o.nsp="";++r;){var a=e.charAt(r);if(","===a)break;if(o.nsp+=a,r===e.length)break}else o.nsp="/";var s=e.charAt(r+1);if(""!==s&&Number(s)==s){for(o.id="";++r;){var a=e.charAt(r);if(null==a||Number(a)!=a){--r;break}if(o.id+=e.charAt(r),r===e.length)break}o.id=Number(o.id)}if(e.charAt(++r)){var u=function(e){try{return JSON.parse(e)}catch(e){return!1}}(e.substr(r)),l=!1!==u&&(o.type===t.ERROR||ae(u));if(!l)return c("invalid payload");o.data=u}return n("decoded %s as %j",e,o),o}(e),t.BINARY_EVENT===r.type||t.BINARY_ACK===r.type?(this.reconstructor=new s(r),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",r)):this.emit("decoded",r);else{if(!se(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(r=this.reconstructor.takeBinaryData(e))&&(this.reconstructor=null,this.emit("decoded",r))}},a.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},s.prototype.takeBinaryData=function(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){var t=de.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null},s.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}}),ve=(ye.protocol,ye.types,ye.CONNECT,ye.DISCONNECT,ye.EVENT,ye.ACK,ye.ERROR,ye.BINARY_EVENT,ye.BINARY_ACK,ye.Encoder,ye.Decoder,G(function(e){try{e.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(t){e.exports=!1}})),ge=function(e){var t=e.xdomain,n=e.xscheme,r=e.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!t||ve))return new XMLHttpRequest}catch(e){}try{if("undefined"!=typeof XDomainRequest&&!n&&r)return new XDomainRequest}catch(e){}if(!t)try{return new(self[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}},me=Object.keys||function(e){var t=[],n=Object.prototype.hasOwnProperty;for(var r in e)n.call(e,r)&&t.push(r);return t},be={}.toString,we=Array.isArray||function(e){return"[object Array]"==be.call(e)},ke=Object.prototype.toString,xe="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===ke.call(Blob),Ce="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===ke.call(File),De=function e(t){if(!t||"object"!=typeof t)return!1;if(we(t)){for(var n=0,r=t.length;n<r;n++)if(e(t[n]))return!0;return!1}if("function"==typeof Buffer&&Buffer.isBuffer&&Buffer.isBuffer(t)||"function"==typeof ArrayBuffer&&t instanceof ArrayBuffer||xe&&t instanceof Blob||Ce&&t instanceof File)return!0;if(t.toJSON&&"function"==typeof t.toJSON&&1===arguments.length)return e(t.toJSON(),!0);for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o)&&e(t[o]))return!0;return!1};var Ee=function(e,t,n){var r=e.byteLength;if(t=t||0,n=n||r,e.slice)return e.slice(t,n);if(t<0&&(t+=r),n<0&&(n+=r),n>r&&(n=r),t>=r||t>=n||0===r)return new ArrayBuffer(0);for(var o=new Uint8Array(e),i=new Uint8Array(n-t),a=t,s=0;a<n;a++,s++)i[s]=o[a];return i.buffer},Oe=function(e,t,n){var r=!1;return n=n||Pe,o.count=e,0===e?t():o;function o(e,i){if(o.count<=0)throw new Error("after called too many times");--o.count,e?(r=!0,t(e),t=n):0!==o.count||r||t(null,i)}};function Pe(){}var Ie,_e,Me,Se=String.fromCharCode;function Ae(e){for(var t,n,r=[],o=0,i=e.length;o<i;)(t=e.charCodeAt(o++))>=55296&&t<=56319&&o<i?56320==(64512&(n=e.charCodeAt(o++)))?r.push(((1023&t)<<10)+(1023&n)+65536):(r.push(t),o--):r.push(t);return r}function Te(e,t){if(e>=55296&&e<=57343){if(t)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function je(e,t){return Se(e>>t&63|128)}function Re(e,t){if(0==(4294967168&e))return Se(e);var n="";return 0==(4294965248&e)?n=Se(e>>6&31|192):0==(4294901760&e)?(Te(e,t)||(e=65533),n=Se(e>>12&15|224),n+=je(e,6)):0==(4292870144&e)&&(n=Se(e>>18&7|240),n+=je(e,12),n+=je(e,6)),n+=Se(63&e|128)}function Ne(){if(Me>=_e)throw Error("Invalid byte index");var e=255&Ie[Me];if(Me++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function Be(e){var t,n;if(Me>_e)throw Error("Invalid byte index");if(Me==_e)return!1;if(t=255&Ie[Me],Me++,0==(128&t))return t;if(192==(224&t)){if((n=(31&t)<<6|Ne())>=128)return n;throw Error("Invalid continuation byte")}if(224==(240&t)){if((n=(15&t)<<12|Ne()<<6|Ne())>=2048)return Te(n,e)?n:65533;throw Error("Invalid continuation byte")}if(240==(248&t)&&(n=(7&t)<<18|Ne()<<12|Ne()<<6|Ne())>=65536&&n<=1114111)return n;throw Error("Invalid UTF-8 detected")}var ze={version:"2.1.2",encode:function(e,t){for(var n=!1!==(t=t||{}).strict,r=Ae(e),o=r.length,i=-1,a="";++i<o;)a+=Re(r[i],n);return a},decode:function(e,t){var n=!1!==(t=t||{}).strict;Ie=Ae(e),_e=Ie.length,Me=0;for(var r,o=[];!1!==(r=Be(n));)o.push(r);return function(e){for(var t,n=e.length,r=-1,o="";++r<n;)(t=e[r])>65535&&(o+=Se((t-=65536)>>>10&1023|55296),t=56320|1023&t),o+=Se(t);return o}(o)}},Le=G(function(e,t){!function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=new Uint8Array(256),r=0;r<e.length;r++)n[e.charCodeAt(r)]=r;t.encode=function(t){var n,r=new Uint8Array(t),o=r.length,i="";for(n=0;n<o;n+=3)i+=e[r[n]>>2],i+=e[(3&r[n])<<4|r[n+1]>>4],i+=e[(15&r[n+1])<<2|r[n+2]>>6],i+=e[63&r[n+2]];return o%3==2?i=i.substring(0,i.length-1)+"=":o%3==1&&(i=i.substring(0,i.length-2)+"=="),i},t.decode=function(e){var t,r,o,i,a,s=.75*e.length,c=e.length,u=0;"="===e[e.length-1]&&(s--,"="===e[e.length-2]&&s--);var l=new ArrayBuffer(s),p=new Uint8Array(l);for(t=0;t<c;t+=4)r=n[e.charCodeAt(t)],o=n[e.charCodeAt(t+1)],i=n[e.charCodeAt(t+2)],a=n[e.charCodeAt(t+3)],p[u++]=r<<2|o>>4,p[u++]=(15&o)<<4|i>>2,p[u++]=(3&i)<<6|63&a;return l}}()}),Fe=(Le.encode,Le.decode,void 0!==Fe?Fe:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder&&MozBlobBuilder),qe=function(){try{return 2===new Blob(["hi"]).size}catch(e){return!1}}(),Ue=qe&&function(){try{return 2===new Blob([new Uint8Array([1,2])]).size}catch(e){return!1}}(),Ge=Fe&&Fe.prototype.append&&Fe.prototype.getBlob;function He(e){return e.map(function(e){if(e.buffer instanceof ArrayBuffer){var t=e.buffer;if(e.byteLength!==t.byteLength){var n=new Uint8Array(e.byteLength);n.set(new Uint8Array(t,e.byteOffset,e.byteLength)),t=n.buffer}return t}return e})}function Xe(e,t){t=t||{};var n=new Fe;return He(e).forEach(function(e){n.append(e)}),t.type?n.getBlob(t.type):n.getBlob()}function Ye(e,t){return new Blob(He(e),t||{})}"undefined"!=typeof Blob&&(Xe.prototype=Blob.prototype,Ye.prototype=Blob.prototype);var We=qe?Ue?Blob:Ye:Ge?Xe:void 0,Ke=G(function(e,t){var n;"undefined"!=typeof ArrayBuffer&&(n=Le);var r="undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),o="undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),i=r||o;t.protocol=3;var a=t.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},s=me(a),c={type:"error",data:"parser error"};function u(e,t,n){for(var r=new Array(e.length),o=Oe(e.length,n),i=function(e,n,o){t(n,function(t,n){r[e]=n,o(t,r)})},a=0;a<e.length;a++)i(a,e[a],o)}t.encodePacket=function(e,n,r,o){"function"==typeof n&&(o=n,n=!1),"function"==typeof r&&(o=r,r=null);var s=void 0===e.data?void 0:e.data.buffer||e.data;if("undefined"!=typeof ArrayBuffer&&s instanceof ArrayBuffer)return function(e,n,r){if(!n)return t.encodeBase64Packet(e,r);var o=e.data,i=new Uint8Array(o),s=new Uint8Array(1+o.byteLength);s[0]=a[e.type];for(var c=0;c<i.length;c++)s[c+1]=i[c];return r(s.buffer)}(e,n,o);if(void 0!==We&&s instanceof We)return function(e,n,r){if(!n)return t.encodeBase64Packet(e,r);if(i)return function(e,n,r){if(!n)return t.encodeBase64Packet(e,r);var o=new FileReader;return o.onload=function(){t.encodePacket({type:e.type,data:o.result},n,!0,r)},o.readAsArrayBuffer(e.data)}(e,n,r);var o=new Uint8Array(1);o[0]=a[e.type];var s=new We([o.buffer,e.data]);return r(s)}(e,n,o);if(s&&s.base64)return function(e,n){var r="b"+t.packets[e.type]+e.data.data;return n(r)}(e,o);var c=a[e.type];return void 0!==e.data&&(c+=r?ze.encode(String(e.data),{strict:!1}):String(e.data)),o(""+c)},t.encodeBase64Packet=function(e,n){var r,o="b"+t.packets[e.type];if(void 0!==We&&e.data instanceof We){var i=new FileReader;return i.onload=function(){var e=i.result.split(",")[1];n(o+e)},i.readAsDataURL(e.data)}try{r=String.fromCharCode.apply(null,new Uint8Array(e.data))}catch(t){for(var a=new Uint8Array(e.data),s=new Array(a.length),c=0;c<a.length;c++)s[c]=a[c];r=String.fromCharCode.apply(null,s)}return o+=btoa(r),n(o)},t.decodePacket=function(e,n,r){if(void 0===e)return c;if("string"==typeof e){if("b"===e.charAt(0))return t.decodeBase64Packet(e.substr(1),n);if(r&&!1===(e=function(e){try{e=ze.decode(e,{strict:!1})}catch(e){return!1}return e}(e)))return c;var o=e.charAt(0);return Number(o)==o&&s[o]?e.length>1?{type:s[o],data:e.substring(1)}:{type:s[o]}:c}o=new Uint8Array(e)[0];var i=Ee(e,1);return We&&"blob"===n&&(i=new We([i])),{type:s[o],data:i}},t.decodeBase64Packet=function(e,t){var r=s[e.charAt(0)];if(!n)return{type:r,data:{base64:!0,data:e.substr(1)}};var o=n.decode(e.substr(1));return"blob"===t&&We&&(o=new We([o])),{type:r,data:o}},t.encodePayload=function(e,n,r){"function"==typeof n&&(r=n,n=null);var o=De(e);if(n&&o)return We&&!i?t.encodePayloadAsBlob(e,r):t.encodePayloadAsArrayBuffer(e,r);if(!e.length)return r("0:");u(e,function(e,r){t.encodePacket(e,!!o&&n,!1,function(e){r(null,function(e){return e.length+":"+e}(e))})},function(e,t){return r(t.join(""))})},t.decodePayload=function(e,n,r){if("string"!=typeof e)return t.decodePayloadAsBinary(e,n,r);var o;if("function"==typeof n&&(r=n,n=null),""===e)return r(c,0,1);for(var i,a,s="",u=0,l=e.length;u<l;u++){var p=e.charAt(u);if(":"===p){if(""===s||s!=(i=Number(s)))return r(c,0,1);if(s!=(a=e.substr(u+1,i)).length)return r(c,0,1);if(a.length){if(o=t.decodePacket(a,n,!1),c.type===o.type&&c.data===o.data)return r(c,0,1);if(!1===r(o,u+i,l))return}u+=i,s=""}else s+=p}return""!==s?r(c,0,1):void 0},t.encodePayloadAsArrayBuffer=function(e,n){if(!e.length)return n(new ArrayBuffer(0));u(e,function(e,n){t.encodePacket(e,!0,!0,function(e){return n(null,e)})},function(e,t){var r=t.reduce(function(e,t){var n;return e+(n="string"==typeof t?t.length:t.byteLength).toString().length+n+2},0),o=new Uint8Array(r),i=0;return t.forEach(function(e){var t="string"==typeof e,n=e;if(t){for(var r=new Uint8Array(e.length),a=0;a<e.length;a++)r[a]=e.charCodeAt(a);n=r.buffer}o[i++]=t?0:1;var s=n.byteLength.toString();for(a=0;a<s.length;a++)o[i++]=parseInt(s[a]);o[i++]=255;for(r=new Uint8Array(n),a=0;a<r.length;a++)o[i++]=r[a]}),n(o.buffer)})},t.encodePayloadAsBlob=function(e,n){u(e,function(e,n){t.encodePacket(e,!0,!0,function(e){var t=new Uint8Array(1);if(t[0]=1,"string"==typeof e){for(var r=new Uint8Array(e.length),o=0;o<e.length;o++)r[o]=e.charCodeAt(o);e=r.buffer,t[0]=0}var i=(e instanceof ArrayBuffer?e.byteLength:e.size).toString(),a=new Uint8Array(i.length+1);for(o=0;o<i.length;o++)a[o]=parseInt(i[o]);if(a[i.length]=255,We){var s=new We([t.buffer,a.buffer,e]);n(null,s)}})},function(e,t){return n(new We(t))})},t.decodePayloadAsBinary=function(e,n,r){"function"==typeof n&&(r=n,n=null);for(var o=e,i=[];o.byteLength>0;){for(var a=new Uint8Array(o),s=0===a[0],u="",l=1;255!==a[l];l++){if(u.length>310)return r(c,0,1);u+=a[l]}o=Ee(o,2+u.length),u=parseInt(u);var p=Ee(o,0,u);if(s)try{p=String.fromCharCode.apply(null,new Uint8Array(p))}catch(e){var h=new Uint8Array(p);p="";for(l=0;l<h.length;l++)p+=String.fromCharCode(h[l])}i.push(p),o=Ee(o,u)}var f=i.length;i.forEach(function(e,o){r(t.decodePacket(e,n,!0),o,f)})}}),Ve=(Ke.protocol,Ke.packets,Ke.encodePacket,Ke.encodeBase64Packet,Ke.decodePacket,Ke.decodeBase64Packet,Ke.encodePayload,Ke.decodePayload,Ke.encodePayloadAsArrayBuffer,Ke.encodePayloadAsBlob,Ke.decodePayloadAsBinary,$e);function $e(e){this.path=e.path,this.hostname=e.hostname,this.port=e.port,this.secure=e.secure,this.query=e.query,this.timestampParam=e.timestampParam,this.timestampRequests=e.timestampRequests,this.readyState="",this.agent=e.agent||!1,this.socket=e.socket,this.enablesXDR=e.enablesXDR,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.forceNode=e.forceNode,this.isReactNative=e.isReactNative,this.extraHeaders=e.extraHeaders,this.localAddress=e.localAddress}oe($e.prototype),$e.prototype.onError=function(e,t){var n=new Error(e);return n.type="TransportError",n.description=t,this.emit("error",n),this},$e.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this},$e.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this},$e.prototype.send=function(e){if("open"!==this.readyState)throw new Error("Transport not open");this.write(e)},$e.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},$e.prototype.onData=function(e){var t=Ke.decodePacket(e,this.socket.binaryType);this.onPacket(t)},$e.prototype.onPacket=function(e){this.emit("packet",e)},$e.prototype.onClose=function(){this.readyState="closed",this.emit("close")};var Je,Ze={encode:function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t},decode:function(e){for(var t={},n=e.split("&"),r=0,o=n.length;r<o;r++){var i=n[r].split("=");t[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return t}},Qe=function(e,t){var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e},et="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),tt=64,nt={},rt=0,ot=0;function it(e){var t="";do{t=et[e%tt]+t,e=Math.floor(e/tt)}while(e>0);return t}function at(){var e=it(+new Date);return e!==Je?(rt=0,Je=e):e+"."+it(rt++)}for(;ot<tt;ot++)nt[et[ot]]=ot;at.encode=it,at.decode=function(e){var t=0;for(ot=0;ot<e.length;ot++)t=t*tt+nt[e.charAt(ot)];return t};var st=at,ct=te("engine.io-client:polling"),ut=pt,lt=null!=new ge({xdomain:!1}).responseType;function pt(e){var t=e&&e.forceBase64;lt&&!t||(this.supportsBinary=!1),Ve.call(this,e)}Qe(pt,Ve),pt.prototype.name="polling",pt.prototype.doOpen=function(){this.poll()},pt.prototype.pause=function(e){var t=this;function n(){ct("paused"),t.readyState="paused",e()}if(this.readyState="pausing",this.polling||!this.writable){var r=0;this.polling&&(ct("we are currently polling - waiting to pause"),r++,this.once("pollComplete",function(){ct("pre-pause polling complete"),--r||n()})),this.writable||(ct("we are currently writing - waiting to pause"),r++,this.once("drain",function(){ct("pre-pause writing complete"),--r||n()}))}else n()},pt.prototype.poll=function(){ct("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},pt.prototype.onData=function(e){var t=this;ct("polling got data %s",e);Ke.decodePayload(e,this.socket.binaryType,function(e,n,r){if("opening"===t.readyState&&t.onOpen(),"close"===e.type)return t.onClose(),!1;t.onPacket(e)}),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():ct('ignoring poll - transport state "%s"',this.readyState))},pt.prototype.doClose=function(){var e=this;function t(){ct("writing close packet"),e.write([{type:"close"}])}"open"===this.readyState?(ct("transport open - closing"),t()):(ct("transport not open - deferring close"),this.once("open",t))},pt.prototype.write=function(e){var t=this;this.writable=!1;var n=function(){t.writable=!0,t.emit("drain")};Ke.encodePayload(e,this.supportsBinary,function(e){t.doWrite(e,n)})},pt.prototype.uri=function(){var e=this.query||{},t=this.secure?"https":"http",n="";return!1!==this.timestampRequests&&(e[this.timestampParam]=st()),this.supportsBinary||e.sid||(e.b64=1),e=Ze.encode(e),this.port&&("https"===t&&443!==Number(this.port)||"http"===t&&80!==Number(this.port))&&(n=":"+this.port),e.length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+e};var ht=te("engine.io-client:polling-xhr"),ft=vt,dt=gt;function yt(){}function vt(e){if(ut.call(this,e),this.requestTimeout=e.requestTimeout,this.extraHeaders=e.extraHeaders,"undefined"!=typeof location){var t="https:"===location.protocol,n=location.port;n||(n=t?443:80),this.xd="undefined"!=typeof location&&e.hostname!==location.hostname||n!==e.port,this.xs=e.secure!==t}}function gt(e){this.method=e.method||"GET",this.uri=e.uri,this.xd=!!e.xd,this.xs=!!e.xs,this.async=!1!==e.async,this.data=void 0!==e.data?e.data:null,this.agent=e.agent,this.isBinary=e.isBinary,this.supportsBinary=e.supportsBinary,this.enablesXDR=e.enablesXDR,this.requestTimeout=e.requestTimeout,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.extraHeaders=e.extraHeaders,this.create()}if(Qe(vt,ut),vt.prototype.supportsBinary=!0,vt.prototype.request=function(e){return(e=e||{}).uri=this.uri(),e.xd=this.xd,e.xs=this.xs,e.agent=this.agent||!1,e.supportsBinary=this.supportsBinary,e.enablesXDR=this.enablesXDR,e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized,e.requestTimeout=this.requestTimeout,e.extraHeaders=this.extraHeaders,new gt(e)},vt.prototype.doWrite=function(e,t){var n="string"!=typeof e&&void 0!==e,r=this.request({method:"POST",data:e,isBinary:n}),o=this;r.on("success",t),r.on("error",function(e){o.onError("xhr post error",e)}),this.sendXhr=r},vt.prototype.doPoll=function(){ht("xhr poll");var e=this.request(),t=this;e.on("data",function(e){t.onData(e)}),e.on("error",function(e){t.onError("xhr poll error",e)}),this.pollXhr=e},oe(gt.prototype),gt.prototype.create=function(){var e={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized;var t=this.xhr=new ge(e),n=this;try{ht("xhr open %s: %s",this.method,this.uri),t.open(this.method,this.uri,this.async);try{if(this.extraHeaders)for(var r in t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0),this.extraHeaders)this.extraHeaders.hasOwnProperty(r)&&t.setRequestHeader(r,this.extraHeaders[r])}catch(e){}if("POST"===this.method)try{this.isBinary?t.setRequestHeader("Content-type","application/octet-stream"):t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{t.setRequestHeader("Accept","*/*")}catch(e){}"withCredentials"in t&&(t.withCredentials=!0),this.requestTimeout&&(t.timeout=this.requestTimeout),this.hasXDR()?(t.onload=function(){n.onLoad()},t.onerror=function(){n.onError(t.responseText)}):t.onreadystatechange=function(){if(2===t.readyState)try{var e=t.getResponseHeader("Content-Type");n.supportsBinary&&"application/octet-stream"===e&&(t.responseType="arraybuffer")}catch(e){}4===t.readyState&&(200===t.status||1223===t.status?n.onLoad():setTimeout(function(){n.onError(t.status)},0))},ht("xhr data %s",this.data),t.send(this.data)}catch(e){return void setTimeout(function(){n.onError(e)},0)}"undefined"!=typeof document&&(this.index=gt.requestsCount++,gt.requests[this.index]=this)},gt.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},gt.prototype.onData=function(e){this.emit("data",e),this.onSuccess()},gt.prototype.onError=function(e){this.emit("error",e),this.cleanup(!0)},gt.prototype.cleanup=function(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=yt:this.xhr.onreadystatechange=yt,e)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete gt.requests[this.index],this.xhr=null}},gt.prototype.onLoad=function(){var e;try{var t;try{t=this.xhr.getResponseHeader("Content-Type")}catch(e){}e="application/octet-stream"===t&&this.xhr.response||this.xhr.responseText}catch(e){this.onError(e)}null!=e&&this.onData(e)},gt.prototype.hasXDR=function(){return"undefined"!=typeof XDomainRequest&&!this.xs&&this.enablesXDR},gt.prototype.abort=function(){this.cleanup()},gt.requestsCount=0,gt.requests={},"undefined"!=typeof document)if("function"==typeof attachEvent)attachEvent("onunload",bt);else if("function"==typeof addEventListener){var mt="onpagehide"in self?"pagehide":"unload";addEventListener(mt,bt,!1)}function bt(){for(var e in gt.requests)gt.requests.hasOwnProperty(e)&&gt.requests[e].abort()}ft.Request=dt;var wt,kt=Ot,xt=/\n/g,Ct=/\\n/g;function Dt(){}function Et(){return"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==q?q:{}}function Ot(e){if(ut.call(this,e),this.query=this.query||{},!wt){var t=Et();wt=t.___eio=t.___eio||[]}this.index=wt.length;var n=this;wt.push(function(e){n.onData(e)}),this.query.j=this.index,"function"==typeof addEventListener&&addEventListener("beforeunload",function(){n.script&&(n.script.onerror=Dt)},!1)}Qe(Ot,ut),Ot.prototype.supportsBinary=!1,Ot.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),ut.prototype.doClose.call(this)},Ot.prototype.doPoll=function(){var e=this,t=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),t.async=!0,t.src=this.uri(),t.onerror=function(t){e.onError("jsonp poll error",t)};var n=document.getElementsByTagName("script")[0];n?n.parentNode.insertBefore(t,n):(document.head||document.body).appendChild(t),this.script=t,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)},100)},Ot.prototype.doWrite=function(e,t){var n=this;if(!this.form){var r,o=document.createElement("form"),i=document.createElement("textarea"),a=this.iframeId="eio_iframe_"+this.index;o.className="socketio",o.style.position="absolute",o.style.top="-1000px",o.style.left="-1000px",o.target=a,o.method="POST",o.setAttribute("accept-charset","utf-8"),i.name="d",o.appendChild(i),document.body.appendChild(o),this.form=o,this.area=i}function s(){c(),t()}function c(){if(n.iframe)try{n.form.removeChild(n.iframe)}catch(e){n.onError("jsonp polling iframe removal error",e)}try{var e='<iframe src="javascript:0" name="'+n.iframeId+'">';r=document.createElement(e)}catch(e){(r=document.createElement("iframe")).name=n.iframeId,r.src="javascript:0"}r.id=n.iframeId,n.form.appendChild(r),n.iframe=r}this.form.action=this.uri(),c(),e=e.replace(Ct,"\\\n"),this.area.value=e.replace(xt,"\\n");try{this.form.submit()}catch(e){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===n.iframe.readyState&&s()}:this.iframe.onload=s};var Pt,It,_t=te("engine.io-client:websocket");if("undefined"!=typeof WebSocket)Pt=WebSocket;else if("undefined"!=typeof self)Pt=self.WebSocket||self.MozWebSocket;else try{It={}}catch(e){}var Mt=Pt||It,St=At;function At(e){e&&e.forceBase64&&(this.supportsBinary=!1),this.perMessageDeflate=e.perMessageDeflate,this.usingBrowserWebSocket=Pt&&!e.forceNode,this.protocols=e.protocols,this.usingBrowserWebSocket||(Mt=It),Ve.call(this,e)}Qe(At,Ve),At.prototype.name="websocket",At.prototype.supportsBinary=!0,At.prototype.doOpen=function(){if(this.check()){var e=this.uri(),t=this.protocols,n={agent:this.agent,perMessageDeflate:this.perMessageDeflate};n.pfx=this.pfx,n.key=this.key,n.passphrase=this.passphrase,n.cert=this.cert,n.ca=this.ca,n.ciphers=this.ciphers,n.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(n.headers=this.extraHeaders),this.localAddress&&(n.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket&&!this.isReactNative?t?new Mt(e,t):new Mt(e):new Mt(e,t,n)}catch(e){return this.emit("error",e)}void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},At.prototype.addEventListeners=function(){var e=this;this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(){e.onClose()},this.ws.onmessage=function(t){e.onData(t.data)},this.ws.onerror=function(t){e.onError("websocket error",t)}},At.prototype.write=function(e){var t=this;this.writable=!1;for(var n=e.length,r=0,o=n;r<o;r++)!function(e){Ke.encodePacket(e,t.supportsBinary,function(r){if(!t.usingBrowserWebSocket){var o={};if(e.options&&(o.compress=e.options.compress),t.perMessageDeflate)("string"==typeof r?Buffer.byteLength(r):r.length)<t.perMessageDeflate.threshold&&(o.compress=!1)}try{t.usingBrowserWebSocket?t.ws.send(r):t.ws.send(r,o)}catch(e){_t("websocket closed before onclose event")}--n||i()})}(e[r]);function i(){t.emit("flush"),setTimeout(function(){t.writable=!0,t.emit("drain")},0)}},At.prototype.onClose=function(){Ve.prototype.onClose.call(this)},At.prototype.doClose=function(){void 0!==this.ws&&this.ws.close()},At.prototype.uri=function(){var e=this.query||{},t=this.secure?"wss":"ws",n="";return this.port&&("wss"===t&&443!==Number(this.port)||"ws"===t&&80!==Number(this.port))&&(n=":"+this.port),this.timestampRequests&&(e[this.timestampParam]=st()),this.supportsBinary||(e.b64=1),(e=Ze.encode(e)).length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+e},At.prototype.check=function(){return!(!Mt||"__initialize"in Mt&&this.name===At.prototype.name)};var Tt={polling:function(e){var t=!1,n=!1,r=!1!==e.jsonp;if("undefined"!=typeof location){var o="https:"===location.protocol,i=location.port;i||(i=o?443:80),t=e.hostname!==location.hostname||i!==e.port,n=e.secure!==o}if(e.xdomain=t,e.xscheme=n,"open"in new ge(e)&&!e.forceJSONP)return new ft(e);if(!r)throw new Error("JSONP disabled");return new kt(e)},websocket:St},jt=[].indexOf,Rt=function(e,t){if(jt)return e.indexOf(t);for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1},Nt=te("engine.io-client:socket"),Bt=zt;function zt(e,t){if(!(this instanceof zt))return new zt(e,t);t=t||{},e&&"object"==typeof e&&(t=e,e=null),e?(e=Y(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=Y(t.host).host),this.secure=null!=t.secure?t.secure:"undefined"!=typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.agent=t.agent||!1,this.hostname=t.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!=typeof location&&location.port?location.port:this.secure?443:80),this.query=t.query||{},"string"==typeof this.query&&(this.query=Ze.decode(this.query)),this.upgrade=!1!==t.upgrade,this.path=(t.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!t.forceJSONP,this.jsonp=!1!==t.jsonp,this.forceBase64=!!t.forceBase64,this.enablesXDR=!!t.enablesXDR,this.timestampParam=t.timestampParam||"t",this.timestampRequests=t.timestampRequests,this.transports=t.transports||["polling","websocket"],this.transportOptions=t.transportOptions||{},this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=t.policyPort||843,this.rememberUpgrade=t.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=t.onlyBinaryUpgrades,this.perMessageDeflate=!1!==t.perMessageDeflate&&(t.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=t.pfx||null,this.key=t.key||null,this.passphrase=t.passphrase||null,this.cert=t.cert||null,this.ca=t.ca||null,this.ciphers=t.ciphers||null,this.rejectUnauthorized=void 0===t.rejectUnauthorized||t.rejectUnauthorized,this.forceNode=!!t.forceNode,this.isReactNative="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),("undefined"==typeof self||this.isReactNative)&&(t.extraHeaders&&Object.keys(t.extraHeaders).length>0&&(this.extraHeaders=t.extraHeaders),t.localAddress&&(this.localAddress=t.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,this.open()}zt.priorWebsocketSuccess=!1,oe(zt.prototype),zt.protocol=Ke.protocol,zt.Socket=zt,zt.Transport=Ve,zt.transports=Tt,zt.parser=Ke,zt.prototype.createTransport=function(e){Nt('creating transport "%s"',e);var t=function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}(this.query);t.EIO=Ke.protocol,t.transport=e;var n=this.transportOptions[e]||{};return this.id&&(t.sid=this.id),new Tt[e]({query:t,socket:this,agent:n.agent||this.agent,hostname:n.hostname||this.hostname,port:n.port||this.port,secure:n.secure||this.secure,path:n.path||this.path,forceJSONP:n.forceJSONP||this.forceJSONP,jsonp:n.jsonp||this.jsonp,forceBase64:n.forceBase64||this.forceBase64,enablesXDR:n.enablesXDR||this.enablesXDR,timestampRequests:n.timestampRequests||this.timestampRequests,timestampParam:n.timestampParam||this.timestampParam,policyPort:n.policyPort||this.policyPort,pfx:n.pfx||this.pfx,key:n.key||this.key,passphrase:n.passphrase||this.passphrase,cert:n.cert||this.cert,ca:n.ca||this.ca,ciphers:n.ciphers||this.ciphers,rejectUnauthorized:n.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:n.perMessageDeflate||this.perMessageDeflate,extraHeaders:n.extraHeaders||this.extraHeaders,forceNode:n.forceNode||this.forceNode,localAddress:n.localAddress||this.localAddress,requestTimeout:n.requestTimeout||this.requestTimeout,protocols:n.protocols||void 0,isReactNative:this.isReactNative})},zt.prototype.open=function(){var e;if(this.rememberUpgrade&&zt.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length){var t=this;return void setTimeout(function(){t.emit("error","No transports available")},0)}e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)},zt.prototype.setTransport=function(e){Nt("setting transport %s",e.name);var t=this;this.transport&&(Nt("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",function(){t.onDrain()}).on("packet",function(e){t.onPacket(e)}).on("error",function(e){t.onError(e)}).on("close",function(){t.onClose("transport close")})},zt.prototype.probe=function(e){Nt('probing transport "%s"',e);var t=this.createTransport(e,{probe:1}),n=!1,r=this;function o(){if(r.onlyBinaryUpgrades){var o=!this.supportsBinary&&r.transport.supportsBinary;n=n||o}n||(Nt('probe transport "%s" opened',e),t.send([{type:"ping",data:"probe"}]),t.once("packet",function(o){if(!n)if("pong"===o.type&&"probe"===o.data){if(Nt('probe transport "%s" pong',e),r.upgrading=!0,r.emit("upgrading",t),!t)return;zt.priorWebsocketSuccess="websocket"===t.name,Nt('pausing current transport "%s"',r.transport.name),r.transport.pause(function(){n||"closed"!==r.readyState&&(Nt("changing transport and sending upgrade packet"),l(),r.setTransport(t),t.send([{type:"upgrade"}]),r.emit("upgrade",t),t=null,r.upgrading=!1,r.flush())})}else{Nt('probe transport "%s" failed',e);var i=new Error("probe error");i.transport=t.name,r.emit("upgradeError",i)}}))}function i(){n||(n=!0,l(),t.close(),t=null)}function a(n){var o=new Error("probe error: "+n);o.transport=t.name,i(),Nt('probe transport "%s" failed because of error: %s',e,n),r.emit("upgradeError",o)}function s(){a("transport closed")}function c(){a("socket closed")}function u(e){t&&e.name!==t.name&&(Nt('"%s" works - aborting "%s"',e.name,t.name),i())}function l(){t.removeListener("open",o),t.removeListener("error",a),t.removeListener("close",s),r.removeListener("close",c),r.removeListener("upgrading",u)}zt.priorWebsocketSuccess=!1,t.once("open",o),t.once("error",a),t.once("close",s),this.once("close",c),this.once("upgrading",u),t.open()},zt.prototype.onOpen=function(){if(Nt("socket open"),this.readyState="open",zt.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){Nt("starting upgrade probes");for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},zt.prototype.onPacket=function(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(Nt('socket receive: type "%s", data "%s"',e.type,e.data),this.emit("packet",e),this.emit("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emit("data",e.data),this.emit("message",e.data)}else Nt('packet received with socket readyState "%s"',this.readyState)},zt.prototype.onHandshake=function(e){this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},zt.prototype.onHeartbeat=function(e){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout(function(){"closed"!==t.readyState&&t.onClose("ping timeout")},e||t.pingInterval+t.pingTimeout)},zt.prototype.setPing=function(){var e=this;clearTimeout(e.pingIntervalTimer),e.pingIntervalTimer=setTimeout(function(){Nt("writing ping packet - expecting pong within %sms",e.pingTimeout),e.ping(),e.onHeartbeat(e.pingTimeout)},e.pingInterval)},zt.prototype.ping=function(){var e=this;this.sendPacket("ping",function(){e.emit("ping")})},zt.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},zt.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(Nt("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},zt.prototype.write=zt.prototype.send=function(e,t,n){return this.sendPacket("message",e,t,n),this},zt.prototype.sendPacket=function(e,t,n,r){if("function"==typeof t&&(r=t,t=void 0),"function"==typeof n&&(r=n,n=null),"closing"!==this.readyState&&"closed"!==this.readyState){(n=n||{}).compress=!1!==n.compress;var o={type:e,data:t,options:n};this.emit("packetCreate",o),this.writeBuffer.push(o),r&&this.once("flush",r),this.flush()}},zt.prototype.close=function(){if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var e=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?r():t()}):this.upgrading?r():t()}function t(){e.onClose("forced close"),Nt("socket closing - telling transport to close"),e.transport.close()}function n(){e.removeListener("upgrade",n),e.removeListener("upgradeError",n),t()}function r(){e.once("upgrade",n),e.once("upgradeError",n)}return this},zt.prototype.onError=function(e){Nt("socket error %j",e),zt.priorWebsocketSuccess=!1,this.emit("error",e),this.onClose("transport error",e)},zt.prototype.onClose=function(e,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){Nt('socket close with reason: "%s"',e);clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",e,t),this.writeBuffer=[],this.prevBufferLen=0}},zt.prototype.filterUpgrades=function(e){for(var t=[],n=0,r=e.length;n<r;n++)~Rt(this.transports,e[n])&&t.push(e[n]);return t};var Lt=Bt,Ft=Ke;Lt.parser=Ft;var qt=function(e,t){for(var n=[],r=(t=t||0)||0;r<e.length;r++)n[r-t]=e[r];return n};var Ut=function(e,t,n){return e.on(t,n),{destroy:function(){e.removeListener(t,n)}}};var Gt=[].slice,Ht=function(e,t){if("string"==typeof t&&(t=e[t]),"function"!=typeof t)throw new Error("bind() requires a function");var n=Gt.call(arguments,2);return function(){return t.apply(e,n.concat(Gt.call(arguments)))}},Xt=G(function(e,t){var n=te("socket.io-client:socket");e.exports=i;var r={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},o=oe.prototype.emit;function i(e,t,n){this.io=e,this.nsp=t,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.flags={},n&&n.query&&(this.query=n.query),this.io.autoConnect&&this.open()}oe(i.prototype),i.prototype.subEvents=function(){if(!this.subs){var e=this.io;this.subs=[Ut(e,"open",Ht(this,"onopen")),Ut(e,"packet",Ht(this,"onpacket")),Ut(e,"close",Ht(this,"onclose"))]}},i.prototype.open=i.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting"),this)},i.prototype.send=function(){var e=qt(arguments);return e.unshift("message"),this.emit.apply(this,e),this},i.prototype.emit=function(e){if(r.hasOwnProperty(e))return o.apply(this,arguments),this;var t=qt(arguments),i={type:(void 0!==this.flags.binary?this.flags.binary:De(t))?ye.BINARY_EVENT:ye.EVENT,data:t,options:{}};return i.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof t[t.length-1]&&(n("emitting packet with ack id %d",this.ids),this.acks[this.ids]=t.pop(),i.id=this.ids++),this.connected?this.packet(i):this.sendBuffer.push(i),this.flags={},this},i.prototype.packet=function(e){e.nsp=this.nsp,this.io.packet(e)},i.prototype.onopen=function(){if(n("transport is open - connecting"),"/"!==this.nsp)if(this.query){var e="object"==typeof this.query?Ze.encode(this.query):this.query;n("sending connect packet with query %s",e),this.packet({type:ye.CONNECT,query:e})}else this.packet({type:ye.CONNECT})},i.prototype.onclose=function(e){n("close (%s)",e),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",e)},i.prototype.onpacket=function(e){var t=e.nsp===this.nsp,n=e.type===ye.ERROR&&"/"===e.nsp;if(t||n)switch(e.type){case ye.CONNECT:this.onconnect();break;case ye.EVENT:case ye.BINARY_EVENT:this.onevent(e);break;case ye.ACK:case ye.BINARY_ACK:this.onack(e);break;case ye.DISCONNECT:this.ondisconnect();break;case ye.ERROR:this.emit("error",e.data)}},i.prototype.onevent=function(e){var t=e.data||[];n("emitting event %j",t),null!=e.id&&(n("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?o.apply(this,t):this.receiveBuffer.push(t)},i.prototype.ack=function(e){var t=this,r=!1;return function(){if(!r){r=!0;var o=qt(arguments);n("sending ack %j",o),t.packet({type:De(o)?ye.BINARY_ACK:ye.ACK,id:e,data:o})}}},i.prototype.onack=function(e){var t=this.acks[e.id];"function"==typeof t?(n("calling ack %s with %j",e.id,e.data),t.apply(this,e.data),delete this.acks[e.id]):n("bad ack %s",e.id)},i.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},i.prototype.emitBuffered=function(){var e;for(e=0;e<this.receiveBuffer.length;e++)o.apply(this,this.receiveBuffer[e]);for(this.receiveBuffer=[],e=0;e<this.sendBuffer.length;e++)this.packet(this.sendBuffer[e]);this.sendBuffer=[]},i.prototype.ondisconnect=function(){n("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},i.prototype.destroy=function(){if(this.subs){for(var e=0;e<this.subs.length;e++)this.subs[e].destroy();this.subs=null}this.io.destroy(this)},i.prototype.close=i.prototype.disconnect=function(){return this.connected&&(n("performing disconnect (%s)",this.nsp),this.packet({type:ye.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},i.prototype.compress=function(e){return this.flags.compress=e,this},i.prototype.binary=function(e){return this.flags.binary=e,this}}),Yt=Wt;function Wt(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}Wt.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-n:e+n}return 0|Math.min(e,this.max)},Wt.prototype.reset=function(){this.attempts=0},Wt.prototype.setMin=function(e){this.ms=e},Wt.prototype.setMax=function(e){this.max=e},Wt.prototype.setJitter=function(e){this.jitter=e};var Kt=te("socket.io-client:manager"),Vt=Object.prototype.hasOwnProperty,$t=Jt;function Jt(e,t){if(!(this instanceof Jt))return new Jt(e,t);e&&"object"==typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.nsps={},this.subs=[],this.opts=t,this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(t.randomizationFactor||.5),this.backoff=new Yt({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this.readyState="closed",this.uri=e,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[];var n=t.parser||ye;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this.autoConnect=!1!==t.autoConnect,this.autoConnect&&this.open()}Jt.prototype.emitAll=function(){for(var e in this.emit.apply(this,arguments),this.nsps)Vt.call(this.nsps,e)&&this.nsps[e].emit.apply(this.nsps[e],arguments)},Jt.prototype.updateSocketIds=function(){for(var e in this.nsps)Vt.call(this.nsps,e)&&(this.nsps[e].id=this.generateId(e))},Jt.prototype.generateId=function(e){return("/"===e?"":e+"#")+this.engine.id},oe(Jt.prototype),Jt.prototype.reconnection=function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection},Jt.prototype.reconnectionAttempts=function(e){return arguments.length?(this._reconnectionAttempts=e,this):this._reconnectionAttempts},Jt.prototype.reconnectionDelay=function(e){return arguments.length?(this._reconnectionDelay=e,this.backoff&&this.backoff.setMin(e),this):this._reconnectionDelay},Jt.prototype.randomizationFactor=function(e){return arguments.length?(this._randomizationFactor=e,this.backoff&&this.backoff.setJitter(e),this):this._randomizationFactor},Jt.prototype.reconnectionDelayMax=function(e){return arguments.length?(this._reconnectionDelayMax=e,this.backoff&&this.backoff.setMax(e),this):this._reconnectionDelayMax},Jt.prototype.timeout=function(e){return arguments.length?(this._timeout=e,this):this._timeout},Jt.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},Jt.prototype.open=Jt.prototype.connect=function(e,t){if(Kt("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;Kt("opening %s",this.uri),this.engine=Lt(this.uri,this.opts);var n=this.engine,r=this;this.readyState="opening",this.skipReconnect=!1;var o=Ut(n,"open",function(){r.onopen(),e&&e()}),i=Ut(n,"error",function(t){if(Kt("connect_error"),r.cleanup(),r.readyState="closed",r.emitAll("connect_error",t),e){var n=new Error("Connection error");n.data=t,e(n)}else r.maybeReconnectOnOpen()});if(!1!==this._timeout){var a=this._timeout;Kt("connect attempt will timeout after %d",a);var s=setTimeout(function(){Kt("connect attempt timed out after %d",a),o.destroy(),n.close(),n.emit("error","timeout"),r.emitAll("connect_timeout",a)},a);this.subs.push({destroy:function(){clearTimeout(s)}})}return this.subs.push(o),this.subs.push(i),this},Jt.prototype.onopen=function(){Kt("open"),this.cleanup(),this.readyState="open",this.emit("open");var e=this.engine;this.subs.push(Ut(e,"data",Ht(this,"ondata"))),this.subs.push(Ut(e,"ping",Ht(this,"onping"))),this.subs.push(Ut(e,"pong",Ht(this,"onpong"))),this.subs.push(Ut(e,"error",Ht(this,"onerror"))),this.subs.push(Ut(e,"close",Ht(this,"onclose"))),this.subs.push(Ut(this.decoder,"decoded",Ht(this,"ondecoded")))},Jt.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},Jt.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},Jt.prototype.ondata=function(e){this.decoder.add(e)},Jt.prototype.ondecoded=function(e){this.emit("packet",e)},Jt.prototype.onerror=function(e){Kt("error",e),this.emitAll("error",e)},Jt.prototype.socket=function(e,t){var n=this.nsps[e];if(!n){n=new Xt(this,e,t),this.nsps[e]=n;var r=this;n.on("connecting",o),n.on("connect",function(){n.id=r.generateId(e)}),this.autoConnect&&o()}function o(){~Rt(r.connecting,n)||r.connecting.push(n)}return n},Jt.prototype.destroy=function(e){var t=Rt(this.connecting,e);~t&&this.connecting.splice(t,1),this.connecting.length||this.close()},Jt.prototype.packet=function(e){Kt("writing packet %j",e);var t=this;e.query&&0===e.type&&(e.nsp+="?"+e.query),t.encoding?t.packetBuffer.push(e):(t.encoding=!0,this.encoder.encode(e,function(n){for(var r=0;r<n.length;r++)t.engine.write(n[r],e.options);t.encoding=!1,t.processPacketQueue()}))},Jt.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var e=this.packetBuffer.shift();this.packet(e)}},Jt.prototype.cleanup=function(){Kt("cleanup");for(var e=this.subs.length,t=0;t<e;t++){this.subs.shift().destroy()}this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},Jt.prototype.close=Jt.prototype.disconnect=function(){Kt("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"===this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},Jt.prototype.onclose=function(e){Kt("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()},Jt.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var e=this;if(this.backoff.attempts>=this._reconnectionAttempts)Kt("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var t=this.backoff.duration();Kt("will wait %dms before reconnect attempt",t),this.reconnecting=!0;var n=setTimeout(function(){e.skipReconnect||(Kt("attempting reconnect"),e.emitAll("reconnect_attempt",e.backoff.attempts),e.emitAll("reconnecting",e.backoff.attempts),e.skipReconnect||e.open(function(t){t?(Kt("reconnect attempt error"),e.reconnecting=!1,e.reconnect(),e.emitAll("reconnect_error",t.data)):(Kt("reconnect success"),e.onreconnect())}))},t);this.subs.push({destroy:function(){clearTimeout(n)}})}},Jt.prototype.onreconnect=function(){var e=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",e)};var Zt=G(function(e,t){var n=te("socket.io-client");e.exports=t=o;var r=t.managers={};function o(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var o,i=re(e),a=i.source,s=i.id,c=i.path,u=r[s]&&c in r[s].nsps;return t.forceNew||t["force new connection"]||!1===t.multiplex||u?(n("ignoring socket cache for %s",a),o=$t(a,t)):(r[s]||(n("new io instance for %s",a),r[s]=$t(a,t)),o=r[s]),i.query&&!t.query&&(t.query=i.query),o.socket(i.path,t)}t.protocol=ye.protocol,t.connect=o,t.Manager=$t,t.Socket=Xt}),Qt=(Zt.managers,Zt.protocol,Zt.connect,Zt.Manager,Zt.Socket,function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.socket,r=t.socketOpts,i=t.store,a=t.gameID,s=t.playerID,c=t.gameName,u=t.numPlayers,l=t.server;o(this,e),this.server=l,this.socket=n,this.store=i,this.socketOpts=r,this.gameName=c||"default",this.gameID=a||"default",this.playerID=s||null,this.numPlayers=u||2,this.gameID=this.gameName+":"+this.gameID,this.isConnected=!1,this.callback=function(){}}return a(e,[{key:"onAction",value:function(e,t){this.socket.emit("update",t,e._stateID,this.gameID,this.playerID)}},{key:"connect",value:function(){var e=this;if(!this.socket)if(this.server){var t=this.server;-1==t.search(/^https?:\/\//)&&(t="http://"+this.server),"/"!=t.substr(-1)&&(t+="/"),this.socket=Zt(t+this.gameName,this.socketOpts)}else this.socket=Zt("/"+this.gameName,this.socketOpts);this.socket.on("update",function(t,n,r){var o=e.store.getState();if(t==e.gameID&&n._stateID>=o._stateID){var i=N(n,r);e.store.dispatch(i)}}),this.socket.on("sync",function(t,n,r){if(t==e.gameID){var o=R(n,r);e.store.dispatch(o)}}),this.socket.emit("sync",this.gameID,this.playerID,this.numPlayers),this.socket.on("connect",function(){e.isConnected=!0,e.callback()}),this.socket.on("disconnect",function(){e.isConnected=!1,e.callback()})}},{key:"subscribe",value:function(e){this.callback=e}},{key:"updateGameID",value:function(e){this.gameID=this.gameName+":"+e;var t=B(null);this.store.dispatch(t),this.socket&&this.socket.emit("sync",this.gameID,this.playerID,this.numPlayers)}},{key:"updatePlayerID",value:function(e){this.playerID=e;var t=B(null);this.store.dispatch(t),this.socket&&this.socket.emit("sync",this.gameID,this.playerID,this.numPlayers)}}]),e}()),en=function(){function e(){o(this,e),this.games=new Map}return a(e,[{key:"connect",value:function(){}},{key:"set",value:function(e,t){return this.games.set(e,t)}},{key:"get",value:function(e){return this.games.get(e)}},{key:"has",value:function(e){return this.games.has(e)}},{key:"remove",value:function(e){this.games.has(e)&&this.games.delete(e)}},{key:"list",value:function(){return v(this.games.keys())}}]),e}(),tn=function(e,t){return{parse:function(t){var n=JSON.parse(t,o).map(r),i=n[0];return"object"==typeof i&&i?function t(n,r,o){return Object.keys(o).reduce(function(o,i){var a=o[i];if(a instanceof e){var s=n[a];"object"!=typeof s||r.has(s)?o[i]=s:(r.add(s),o[i]=t(n,r,s))}return o},o)}(n,new Set,i):i},stringify:function(e){for(var r,o=new Map,i=[],a=[],s=+n(o,i,e),c=function(e,a){if(r)return r=!r,a;switch(typeof a){case"object":if(null===a)return a;case t:return o.get(a)||n(o,i,a)}return a};s<i.length;s++)r=!0,a[s]=JSON.stringify(i[s],c);return"["+a.join(",")+"]"}};function n(t,n,r){var o=e(n.push(r)-1);return t.set(r,o),o}function r(t){return t instanceof e?e(t):t}function o(n,r){return typeof r===t?new e(r):r}}(String,"string");const nn=tn.parse,rn=tn.stringify;function on(e){var t,n=this,r=(t=4022871197,function(e){e=e.toString();for(var n=0;n<e.length;n++){var r=.02519603282416938*(t+=e.charCodeAt(n));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)});n.next=function(){var e=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=e-(n.c=0|e)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(e),n.s0<0&&(n.s0+=1),n.s1-=r(e),n.s1<0&&(n.s1+=1),n.s2-=r(e),n.s2<0&&(n.s2+=1),r=null}function an(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function sn(e,t){var n=new on(e),o=t&&t.state,i=n.next;return i.quick=i,o&&("object"==r(o)&&an(o,n),i.state=function(){return an(n,{})}),i}var cn=function(){function e(t){o(this,e),this.state=t._random||{seed:"0"}}return a(e,[{key:"update",value:function(e){var t=u({},e.ctx,{_random:this.state});return u({},e,{ctx:t})}},{key:"attach",value:function(e){return u({},e,{random:this._api()})}},{key:"_random",value:function(){var e,t=this.state,n=(e=void 0===t.prngstate?new sn(t.seed,{state:!0}):new sn("",{state:t.prngstate}))();return this.state=u({},t,{prngstate:e.state()}),n}},{key:"_api",value:function(){var e=this._random.bind(this),t={D4:4,D6:6,D8:8,D10:10,D12:12,D20:20},n={},r=function(r){var o=t[r];n[r]=function(t){return void 0===t?Math.floor(e()*o)+1:v(new Array(t).keys()).map(function(){return Math.floor(e()*o)+1})}};for(var o in t)r(o);return u({},n,{Die:function(t,n){return void 0===t&&(t=6),void 0===n?Math.floor(e()*t)+1:v(new Array(n).keys()).map(function(){return Math.floor(e()*t)+1})},Number:function(){return e()},Shuffle:function(t){for(var n=t.slice(0),r=t.length,o=0,i=new Array(r);r;){var a=r*e()|0;i[o++]=n[a],n[a]=n[--r]}return i}})}}]),e}();cn.detach=function(e){e.random;return f(e,["random"])},cn.seed=function(){return(+new Date).toString(36).slice(-10)};var un=function(){function e(t,n){o(this,e),this.flow=t,this.playerID=n,this.dispatch=[]}return a(e,[{key:"attach",value:function(e){var t=this,n={},r=!0,o=!1,i=void 0;try{for(var a,s=function(){var e=a.value;n[e]=function(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];t.dispatch.push({key:e,args:r})}},c=this.flow.eventNames[Symbol.iterator]();!(r=(a=c.next()).done);r=!0)s()}catch(e){o=!0,i=e}finally{try{r||null==c.return||c.return()}finally{if(o)throw i}}return u({},e,{events:n})}},{key:"update",value:function(e){var t=!0,n=!1,r=void 0;try{for(var o,i=this.dispatch[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var a=o.value,s=j(a.key,a.args,this.playerID);e=u({},e,this.flow.processGameEvent(e,s))}}catch(e){n=!0,r=e}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}return e}}]),e}();un.detach=function(e){e.events;return f(e,["events"])};var ln,pn,hn,fn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},dn=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},yn=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),vn="undefined"!=typeof Symbol?Symbol("immer-nothing"):(hn=!0,(pn="immer-nothing")in(ln={})?Object.defineProperty(ln,pn,{value:hn,enumerable:!0,configurable:!0,writable:!0}):ln[pn]=hn,ln),gn="undefined"!=typeof Symbol?Symbol("immer-draftable"):"__$immer_draftable",mn="undefined"!=typeof Symbol?Symbol("immer-state"):"__$immer_state";function bn(e){return!!e&&!!e[mn]}function wn(e){if(!e||"object"!==(void 0===e?"undefined":fn(e)))return!1;if(Array.isArray(e))return!0;var t=Object.getPrototypeOf(e);return!t||t===Object.prototype||(!!e[gn]||!!e.constructor[gn])}var kn=Object.assign||function(e,t){for(var n in t)On(t,n)&&(e[n]=t[n]);return e},xn="undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:void 0!==Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames;function Cn(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(Array.isArray(e))return e.slice();var n=Object.create(Object.getPrototypeOf(e));return xn(e).forEach(function(r){if(r!==mn){var o=Object.getOwnPropertyDescriptor(e,r);if(o.get){if(!t)throw new Error("Immer drafts cannot have computed properties");o.value=o.get.call(e)}o.enumerable?n[r]=o.value:Object.defineProperty(n,r,{value:o.value,writable:!0,configurable:!0})}}),n}function Dn(e,t){if(Array.isArray(e))for(var n=0;n<e.length;n++)t(n,e[n],e);else xn(e).forEach(function(n){return t(n,e[n],e)})}function En(e,t){return Object.getOwnPropertyDescriptor(e,t).enumerable}function On(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Pn(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}var In={},_n=[],Mn=function(){return _n[_n.length-1]};function Sn(e,t){var n=Array.isArray(e),r=Nn(e);Dn(r,function(t){!function(e,t,n){var r=In[t];r?r.enumerable=n:In[t]=r={configurable:!0,enumerable:n,get:function(){return function(e,t){Bn(e);var n=Tn(e)[t];if(!e.finalizing&&n===e.base[t]&&wn(n))return Rn(e),e.copy[t]=Sn(n,e);return n}(this[mn],t)},set:function(e){!function(e,t,n){if(Bn(e),e.assigned[t]=!0,!e.modified){if(Pn(Tn(e)[t],n))return;jn(e),Rn(e)}e.copy[t]=n}(this[mn],t,e)}};Object.defineProperty(e,t,r)}(r,t,n||En(e,t))});var o,i,a,s={scope:t?t.scope:Mn(),modified:!1,finalizing:!1,finalized:!1,assigned:{},parent:t,base:e,draft:r,copy:null,revoke:An,revoked:!1};return o=r,i=mn,a=s,Object.defineProperty(o,i,{value:a,enumerable:!1,writable:!0}),s.scope.push(s),r}function An(){this.revoked=!0}function Tn(e){return e.copy||e.base}function jn(e){e.modified||(e.modified=!0,e.parent&&jn(e.parent))}function Rn(e){e.copy||(e.copy=Nn(e.base))}function Nn(e){var t=e&&e[mn];if(t){t.finalizing=!0;var n=Cn(t.draft,!0);return t.finalizing=!1,n}return Cn(e)}function Bn(e){if(!0===e.revoked)throw new Error("Cannot use a proxy that has been revoked. Did you pass an object from inside an immer function to an async process? "+JSON.stringify(Tn(e)))}function zn(e){for(var t=e.base,n=e.draft,r=Object.keys(n),o=r.length-1;o>=0;o--)if(void 0===t[r[o]]&&!On(t,r[o]))return!0;return r.length!==Object.keys(t).length}function Ln(e){var t=e.draft;if(t.length!==e.base.length)return!0;var n=Object.getOwnPropertyDescriptor(t,t.length-1);return!(!n||n.get)}var Fn=Object.freeze({scopes:_n,currentScope:Mn,willFinalize:function(e,t,n){var r=Mn();r.forEach(function(e){return e.finalizing=!0}),void 0!==e&&e!==t||(n&&function e(t){if(t&&"object"===(void 0===t?"undefined":fn(t))){var n=t[mn];if(n){var r=n.base,o=n.draft,i=n.assigned;if(Array.isArray(t)){if(Ln(n)){if(jn(n),i.length=!0,o.length<r.length)for(var a=o.length;a<r.length;a++)i[a]=!1;else for(var s=r.length;s<o.length;s++)i[s]=!0;for(var c=0;c<o.length;c++)void 0===i[c]&&e(o[c])}}else Object.keys(o).forEach(function(t){void 0!==r[t]||On(r,t)?i[t]||e(o[t]):(i[t]=!0,jn(n))}),Object.keys(r).forEach(function(e){void 0!==o[e]||On(o,e)||(i[e]=!1,jn(n))})}}}(t),function(e){for(var t=e.length-1;t>=0;t--){var n=e[t];!1===n.modified&&(Array.isArray(n.base)?Ln(n)&&jn(n):zn(n)&&jn(n))}}(r))},createDraft:Sn}),qn=[],Un=function(){return qn[qn.length-1]};function Gn(e,t){var n={scope:t?t.scope:Un(),modified:!1,finalized:!1,assigned:{},parent:t,base:e,draft:null,drafts:{},copy:null,revoke:null},r=Array.isArray(e)?Proxy.revocable([n],Xn):Proxy.revocable(n,Hn),o=r.revoke,i=r.proxy;return n.draft=i,n.revoke=o,n.scope.push(n),i}var Hn={get:function(e,t){if(t===mn)return e;var n=e.drafts;if(!e.modified&&On(n,t))return n[t];var r=Yn(e)[t];if(e.finalized||!wn(r))return r;if(e.modified){if(r!==e.base[t])return r;n=e.copy}return n[t]=Gn(r,e)},has:function(e,t){return t in Yn(e)},ownKeys:function(e){return Reflect.ownKeys(Yn(e))},set:function(e,t,n){if(!e.modified){var r=n?Pn(e.base[t],n)||n===e.drafts[t]:Pn(e.base[t],n)&&t in e.base;if(r)return!0;Wn(e)}return e.assigned[t]=!0,e.copy[t]=n,!0},deleteProperty:function(e,t){(void 0!==e.base[t]||t in e.base)&&(e.assigned[t]=!1,Wn(e));e.copy&&delete e.copy[t];return!0},getOwnPropertyDescriptor:function(e,t){var n=Yn(e),r=Reflect.getOwnPropertyDescriptor(n,t);r&&(r.writable=!0,r.configurable=!Array.isArray(n)||"length"!==t);return r},defineProperty:function(){throw new Error("Object.defineProperty() cannot be used on an Immer draft")},getPrototypeOf:function(e){return Object.getPrototypeOf(e.base)},setPrototypeOf:function(){throw new Error("Object.setPrototypeOf() cannot be used on an Immer draft")}},Xn={};function Yn(e){return e.copy||e.base}function Wn(e){e.modified||(e.modified=!0,e.copy=kn(Cn(e.base),e.drafts),e.drafts=null,e.parent&&Wn(e.parent))}Dn(Hn,function(e,t){Xn[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}}),Xn.deleteProperty=function(e,t){if(isNaN(parseInt(t)))throw new Error("Immer only supports deleting array indices");return Hn.deleteProperty.call(this,e[0],t)},Xn.set=function(e,t,n){if("length"!==t&&isNaN(parseInt(t)))throw new Error("Immer only supports setting array indices and the 'length' property");return Hn.set.call(this,e[0],t,n)};var Kn=Object.freeze({scopes:qn,currentScope:Un,willFinalize:function(){},createDraft:Gn});function Vn(e,t,n,r){Array.isArray(e.base)?function(e,t,n,r){for(var o=e.base,i=e.copy,a=e.assigned,s=Math.min(o.length,i.length),c=0;c<s;c++)if(a[c]&&o[c]!==i[c]){var u=t.concat(c);n.push({op:"replace",path:u,value:i[c]}),r.push({op:"replace",path:u,value:o[c]})}if(s<i.length){for(var l=s;l<i.length;l++)n.push({op:"add",path:t.concat(l),value:i[l]});r.push({op:"replace",path:t.concat("length"),value:o.length})}else if(s<o.length){n.push({op:"replace",path:t.concat("length"),value:i.length});for(var p=s;p<o.length;p++)r.push({op:"add",path:t.concat(p),value:o[p]})}}(e,t,n,r):function(e,t,n,r){var o=e.base,i=e.copy;Dn(e.assigned,function(e,a){var s=o[e],c=i[e],u=a?e in o?"replace":"add":"remove";if(s!==c||"replace"!==u){var l=t.concat(e);n.push("remove"===u?{op:u,path:l}:{op:u,path:l,value:c}),r.push("add"===u?{op:"remove",path:l}:"remove"===u?{op:"add",path:l,value:s}:{op:"replace",path:l,value:s})}})}(e,t,n,r)}function $n(e,t){for(var n=0;n<t.length;n++){var r=t[n],o=r.path;if(0===o.length&&"replace"===r.op)e=r.value;else{for(var i=e,a=0;a<o.length-1;a++)if(!(i=i[o[a]])||"object"!==(void 0===i?"undefined":fn(i)))throw new Error("Cannot apply patch, path doesn't resolve: "+o.join("/"));var s=o[o.length-1];switch(r.op){case"replace":case"add":i[s]=r.value;break;case"remove":if(Array.isArray(i)){if(s!==i.length-1)throw new Error("Only the last index of an array can be removed, index: "+s+", length: "+i.length);i.length-=1}else delete i[s];break;default:throw new Error("Unsupported patch operation: "+r.op)}}}return e}var Jn={useProxies:"undefined"!=typeof Proxy&&"undefined"!=typeof Reflect,autoFreeze:"undefined"==typeof process&&"verifyMinified"===function(){}.name,onAssign:null,onDelete:null,onCopy:null},Zn=new(function(){function e(t){dn(this,e),kn(this,Jn,t),this.setUseProxies(this.useProxies),this.produce=this.produce.bind(this)}return yn(e,[{key:"produce",value:function(e,t,n){var r=this;if("function"==typeof e&&"function"!=typeof t){var o=t;return t=e,function(){for(var e=arguments.length,n=Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o;return r.produce(a,function(e){var r;return(r=t).call.apply(r,[e,e].concat(n))})}}if("function"!=typeof t)throw new Error("if first argument is not a function, the second argument to produce should be a function");if(void 0!==n&&"function"!=typeof n)throw new Error("the third argument of a producer should not be set or a function");var i=void 0;if(wn(e)){this.scopes.push([]);var a=this.createDraft(e);try{i=t.call(a,a),this.willFinalize(i,a,!!n);var s=n&&[],c=n&&[];if(void 0===i||i===a)i=this.finalize(a,[],s,c);else{if(a[mn].modified)throw new Error("An immer producer returned a new value *and* modified its draft. Either return a new value *or* modify the draft.");wn(i)&&(i=this.finalize(i)),n&&(s.push({op:"replace",path:[],value:i}),c.push({op:"replace",path:[],value:e}))}}finally{this.currentScope().forEach(function(e){return e.revoke()}),this.scopes.pop()}n&&n(s,c)}else if(void 0===(i=t(e)))return e;return i===vn?void 0:i}},{key:"setAutoFreeze",value:function(e){this.autoFreeze=e}},{key:"setUseProxies",value:function(e){this.useProxies=e,kn(this,e?Kn:Fn)}},{key:"applyPatches",value:function(e,t){return bn(e)?$n(e,t):this.produce(e,function(e){return $n(e,t)})}},{key:"finalize",value:function(e,t,n,r){var o=this,i=e[mn];if(!i)return Object.isFrozen(e)?e:this.finalizeTree(e);if(i.scope!==this.currentScope())return e;if(!i.modified)return i.base;if(!i.finalized){if(i.finalized=!0,this.finalizeTree(i.draft,t,n,r),this.onDelete)if(this.useProxies){var a=i.assigned;for(var s in a)a[s]||this.onDelete(i,s)}else{var c=i.base,u=i.copy;Dn(c,function(e){On(u,e)||o.onDelete(i,e)})}this.onCopy&&this.onCopy(i),this.autoFreeze&&1===this.scopes.length&&Object.freeze(i.copy),n&&Vn(i,t,n,r)}return i.copy}},{key:"finalizeTree",value:function(e,t,n,r){var o=this,i=e[mn];i&&(this.useProxies||(i.finalizing=!0,i.copy=Cn(i.draft,!0),i.finalizing=!1),e=i.copy);var a=this.onAssign;return Dn(e,function s(c,u,l){if(u===l)throw Error("Immer forbids circular references");var p=!!i&&l===e;if(bn(u)){if(u=n&&p&&!i.assigned[c]?o.finalize(u,t.concat(c),n,r):o.finalize(u),Array.isArray(l)||En(l,c)?l[c]=u:Object.defineProperty(l,c,{value:u}),p&&u===i.base[c])return}else{if(p&&Pn(u,i.base[c]))return;wn(u)&&!Object.isFrozen(u)&&Dn(u,s)}p&&a&&a(i,c,u)}),e}}]),e}()),Qn=Zn.produce,er=(Zn.setAutoFreeze.bind(Zn),Zn.setUseProxies.bind(Zn),Zn.applyPatches.bind(Zn),[{fnWrap:function(e){return Qn(e)}}]),tr=function(e,t){var n=[].concat(er,v(t.plugins)).filter(function(e){return void 0!==e.fnWrap}).reduce(function(e,n){return(0,n.fnWrap)(e,t)},e);return function(e,r){e=function(e,t){return[].concat(er,v(t.plugins)).filter(function(e){return void 0!==e.G}).filter(function(e){return void 0!==e.G.preMove}).forEach(function(n){e=n.G.preMove(e,t)}),e}(e,t),r=function(e,t){return[].concat(er,v(t.plugins)).filter(function(e){return void 0!==e.ctx}).filter(function(e){return void 0!==e.ctx.preMove}).forEach(function(n){e=n.ctx.preMove(e,t)}),e}(r,t);for(var o=arguments.length,i=new Array(o>2?o-2:0),a=2;a<o;a++)i[a-2]=arguments[a];return e=function(e,t){return[].concat(er,v(t.plugins)).filter(function(e){return void 0!==e.G}).filter(function(e){return void 0!==e.G.postMove}).forEach(function(n){e=n.G.postMove(e,t)}),e}(e=n.apply(void 0,[e,r].concat(i)),t)}},nr={setup:function(e,t,n){return[].concat(er,v(n.plugins)).filter(function(e){return void 0!==e.G}).filter(function(e){return void 0!==e.G.setup}).forEach(function(r){e=r.G.setup(e,t,n)}),e},onPhaseBegin:function(e,t,n){return[].concat(er,v(n.plugins)).filter(function(e){return void 0!==e.G}).filter(function(e){return void 0!==e.G.onPhaseBegin}).forEach(function(r){e=r.G.onPhaseBegin(e,t,n)}),e}},rr={setup:function(e,t){return[].concat(er,v(t.plugins)).filter(function(e){return void 0!==e.ctx}).filter(function(e){return void 0!==e.ctx.setup}).forEach(function(n){e=n.ctx.setup(e,t)}),e},onPhaseBegin:function(e,t){return[].concat(er,v(t.plugins)).filter(function(e){return void 0!==e.ctx}).filter(function(e){return void 0!==e.ctx.onPhaseBegin}).forEach(function(n){e=n.ctx.onPhaseBegin(e,t)}),e}},or="INVALID_MOVE",ir=function(){function e(){o(this,e),this._payload=void 0}return a(e,[{key:"_api",value:function(){var e=this;return{setPayload:function(t){e._payload=t}}}},{key:"attach",value:function(e){return u({},e,{log:this._api()})}},{key:"update",value:function(e){if(void 0===this._payload)return e;var t=e.deltalog;return t[t.length-1]=u({},t[t.length-1],{payload:this._payload}),this._payload=void 0,u({},e,{deltalog:t})}}],[{key:"detach",value:function(e){e.log;return f(e,["log"])}}]),e}(),ar=function(){function e(t,n,r){o(this,e),this.random=new cn(t),this.events=new un(n.flow,r),this.log=new ir}return a(e,[{key:"attachToContext",value:function(e){var t=this.random.attach(e);return t=this.events.attach(t),t=this.log.attach(t)}},{key:"_update",value:function(e,t){var n=t?this.events.update(e):e;return n=this.random.update(n),n=this.log.update(n)}},{key:"updateAndDetach",value:function(t,n){var r=this._update(t,n);return r.ctx=e.detachAllFromContext(r.ctx),r}}],[{key:"detachAllFromContext",value:function(e){var t=cn.detach(e);return t=un.detach(t),t=ir.detach(t)}}]),e}();function sr(e){var t=e.game,n=e.numPlayers,r=e.setupData;n||(n=2);var o=t.flow.ctx(n),i=t.seed;void 0===i&&(i=cn.seed()),o._random={seed:i},o=rr.setup(o,t);var a=new ar(o,t,o.currentPlayer),s=a.attachToContext(o),c=t.setup(s,r),u={G:c=nr.setup(c,s,t),ctx:o,_undo:[],_redo:[],_stateID:0,_initial:{}},l=t.flow.init({G:u.G,ctx:s});u.G=l.G,u._undo=l._undo,l=a.updateAndDetach(l,!0),u.ctx=l.ctx;return u._initial=nn(rn(u)),u}function cr(e){var t=e.game,n=e.multiplayer;return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1?arguments[1]:void 0;switch(r.type){case O:if(e=u({},e,{deltalog:[]}),n)return e;if(null!==r.payload.playerID&&void 0!==r.payload.playerID&&!t.flow.canPlayerCallEvent(e.G,e.ctx,r.payload.playerID))return e;var o=new ar(e.ctx,t,r.payload.playerID);e.ctx=o.attachToContext(e.ctx);var i=t.flow.processGameEvent(e,r);return u({},i=o.updateAndDetach(i,!0),{_stateID:e._stateID+1});case E:if(e=u({},e,{deltalog:[]}),!t.moveNames.includes(r.payload.type))return e;if(!t.flow.canMakeMove(e.G,e.ctx,r.payload.type))return e;if(null!==r.payload.playerID&&void 0!==r.payload.playerID&&!t.flow.canPlayerMakeMove(e.G,e.ctx,r.payload.playerID))return e;var a=new ar(e.ctx,t,r.payload.playerID),s=a.attachToContext(e.ctx),c=t.processMove(e.G,r.payload,s);if(c===or)return e;var l={action:r,_stateID:e._stateID,turn:e.ctx.turn,phase:e.ctx.phase},p=a.updateAndDetach(u({},e,{deltalog:[l]}),!1),h=p.ctx;return n&&!t.flow.optimisticUpdate(c,h,r.payload)&&(c=e.G),e=u({},p,{G:c,ctx:h,_stateID:e._stateID+1}),n?e:(s=a.attachToContext(e.ctx),e=t.flow.processMove(u({},e,{ctx:s}),r.payload),(e=a.updateAndDetach(e,!0))._undo[e._undo.length-1].ctx=e.ctx,e);case I:case S:case _:return r.state;case M:var f=e,d=f._undo,y=f._redo;if(d.length<2)return e;var g=d[d.length-1],m=d[d.length-2];return t.flow.canUndoMove(e.G,e.ctx,g.moveType)?u({},e,{G:m.G,ctx:m.ctx,_undo:d.slice(0,d.length-1),_redo:[g].concat(v(y))}):e;case P:var b=e,w=b._undo,k=b._redo;if(0==k.length)return e;var x=k[0];return u({},e,{G:x.G,ctx:x.ctx,_undo:[].concat(v(w),[x]),_redo:k.slice(1)});default:return e}}}var ur=function(e){return"".concat(e,":metadata")};function lr(e,t,n){return void 0===e||void 0===t?t:t.map(function(t){if(null!==n&&+n==+t.action.payload.playerID)return t;if("MAKE_MOVE"!==t.action.type)return t;var r=t.action.payload.type,o=t;if(e.includes(r)){var i=u({},o.action.payload,{args:void 0,argsRedacted:!0});o=u({},o,{action:u({},o.action,{payload:i})})}return o})}var pr=function(e){var t=e.action,n=e.gameMetadata,r=e.playerID;return!n||(!t.payload||(!Object.keys(n.players).some(function(e){return!(!n.players[e]||!n.players[e].credentials)})||!!t.payload.credentials&&t.payload.credentials===n.players[r].credentials))},hr=function(){function e(t,n,r,i){o(this,e),this.game=t,this.storageAPI=n,this.transportAPI=r,this.auth=function(){return!0},!0===i?this.auth=pr:"function"==typeof i&&(this.auth=i)}return a(e,[{key:"onUpdate",value:async function(e,t,n,r){var o,i=this;if(this.executeSynchronously){var a=this.storageAPI.get(ur(n));o=this.auth({action:e,gameMetadata:a,gameID:n,playerID:r})}else{var s=await this.storageAPI.get(ur(n));o=this.auth({action:e,gameMetadata:s,gameID:n,playerID:r})}if(!o)return{error:"unauthorized action"};var c,l=n;if(void 0===(c=this.executeSynchronously?this.storageAPI.get(l):await this.storageAPI.get(l)))return{error:"game not found"};var p=w(cr({game:this.game,numPlayers:c.ctx.numPlayers}),c);if((e.type!=M&&e.type!=P||c.ctx.currentPlayer===r&&1==c.ctx.actionPlayers.length&&c.ctx.actionPlayers[0]===r)&&(e.type!=E||this.game.flow.canPlayerMakeMove(c.G,c.ctx,r))&&(e.type!=O||this.game.flow.canPlayerCallEvent(c.G,c.ctx,r)))if(c._stateID===t){var h=p.getState().log||[];p.dispatch(e),c=p.getState(),this.transportAPI.sendAll(function(e){var t=u({},c,{G:i.game.playerView(c.G,c.ctx,e),ctx:u({},c.ctx,{_random:void 0}),log:void 0,deltalog:void 0,_undo:[],_redo:[],_initial:u({},c._initial,{_undo:[],_redo:[]})}),r=lr(i.game.flow.redactedMoves,c.deltalog,e);return{type:"update",args:[n,t,r]}}),h=[].concat(v(h),v(c.deltalog));var f=u({},c,{log:h});this.executeSynchronously?this.storageAPI.set(l,f):await this.storageAPI.set(l,f)}else"invalid stateID, was=[".concat(t,"], expected=[").concat(c._stateID,"]")}},{key:"onSync",value:async function(e,t,n){var r,o=e;void 0===(r=this.executeSynchronously?this.storageAPI.get(o):await this.storageAPI.get(o))&&(r=sr({game:this.game,numPlayers:n}),this.executeSynchronously?(this.storageAPI.set(o,r),r=this.storageAPI.get(o)):(await this.storageAPI.set(o,r),r=await this.storageAPI.get(o)));var i=u({},r,{G:this.game.playerView(r.G,r.ctx,t),ctx:u({},r.ctx,{_random:void 0}),log:void 0,deltalog:void 0,_undo:[],_redo:[],_initial:u({},r._initial,{_undo:[],_redo:[]})}),a=lr(this.game.flow.redactedMoves,r.log,t);this.transportAPI.send({playerID:t,type:"sync",args:[e,i,a]})}}]),e}();function fr(e){var t={},n=function(e){var n=e.type,r=e.playerID,o=e.args,i=t[r];void 0!==i&&i.apply(null,[n].concat(v(o)))},r=new hr(e,new en,{send:n,sendAll:function(e){for(var r in t){var o=e(r),i=o.type,a=o.args;n({type:i,playerID:r,args:a})}}},!1);return r.executeSynchronously=!0,r.connect=function(e,n,r){t[n]=r},r}var dr=function(){function e(t){var n=t.master,r=t.store,i=t.gameID,a=t.playerID,s=t.gameName,c=t.numPlayers;o(this,e),this.master=n,this.store=r,this.gameName=s||"default",this.gameID=i||"default",this.playerID=a||null,this.numPlayers=c||2,this.gameID=this.gameName+":"+this.gameID,this.isConnected=!0}return a(e,[{key:"onUpdate",value:function(e,t,n){var r=this.store.getState();if(e==this.gameID&&t._stateID>=r._stateID){var o=N(t,n);this.store.dispatch(o)}}},{key:"onSync",value:function(e,t,n){if(e==this.gameID){var r=R(t,n);this.store.dispatch(r)}}},{key:"onAction",value:function(e,t){this.master.onUpdate(t,e._stateID,this.gameID,this.playerID)}},{key:"connect",value:function(){var e=this;this.master.connect(this.gameID,this.playerID,function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];"sync"==t&&e.onSync.apply(e,r),"update"==t&&e.onUpdate.apply(e,r)}),this.master.onSync(this.gameID,this.playerID,this.numPlayers)}},{key:"subscribe",value:function(){}},{key:"updateGameID",value:function(e){this.gameID=this.gameName+":"+e;var t=B(null);this.store.dispatch(t),this.master.onSync(this.gameID,this.playerID,this.numPlayers)}},{key:"updatePlayerID",value:function(e){this.playerID=e;var t=B(null);this.store.dispatch(t),this.master.onSync(this.gameID,this.playerID,this.numPlayers)}}]),e}(),yr=null;function vr(e,t,n,r,o,i){return t.reduce(function(t,a){return t[a]=function(){var t=r;i||null!=r||(t=n.getState().ctx.currentPlayer);for(var s=arguments.length,c=new Array(s),u=0;u<s;u++)c[u]=arguments[u];n.dispatch(F[e](a,c,t,o))},t},{})}var gr=vr.bind(null,"gameEvent"),mr=vr.bind(null,"makeMove"),br=function(){function e(t){var n=this,r=t.game,i=t.ai,a=t.numPlayers,s=t.multiplayer,c=t.socketOpts,u=t.gameID,l=t.playerID,p=t.credentials,h=t.enhancer;if(o(this,e),this.game=r,this.playerID=l,this.gameID=u,this.credentials=p,this.multiplayer=s,this.subscribeCallback=function(){},this.reducer=cr({game:r,numPlayers:a,multiplayer:s}),void 0!==i&&void 0===s){var f=new i.bot({game:r,enumerate:i.enumerate});this.step=async function(){var e=n.store.getState(),t=e.ctx.actionPlayers[0],r=await f.play(e,t),o=r.action,i=r.metadata;return o&&(o.payload.metadata=i,n.store.dispatch(o)),o}}var d=null;void 0===s&&(d=sr({game:r,numPlayers:a})),this.reset=function(){n.store.dispatch(B(d))},this.undo=function(){n.store.dispatch(z())},this.redo=function(){n.store.dispatch(L())},this.store=null,this.log=[];var y=function(e){return function(t){return function(r){var o=t(r),i=e.getState();switch(r.type){case E:case O:var a=i.deltalog;n.log=[].concat(v(n.log),v(a));break;case I:n.log=[];break;case S:var s=-1;n.log.length>0&&(s=n.log[n.log.length-1]._stateID);var c=r.deltalog||[];c=c.filter(function(e){return e._stateID>s}),n.log=[].concat(v(n.log),v(c));break;case _:n.log=r.log||[]}return o}}},g=function(e){return function(t){return function(r){var o=e.getState(),i=t(r);return 1!=r.clientOnly&&n.transport.onAction(o,r),i}}},m=function(){return function(e){return function(t){var r=e(t);return n.subscribeCallback(),r}}};h=void 0!==h?C(D(m,g,y),h):D(m,g,y),this.store=w(this.reducer,d,h),this.transport={isConnected:!0,onAction:function(){},subscribe:function(){},connect:function(){},updateGameID:function(){},updatePlayerID:function(){}},void 0!==s&&(!0===s&&(s={server:""}),!0===s.local?(null!==yr&&yr.game===r||(yr=new fr(r)),this.transport=new dr({master:yr,store:this.store,gameID:u,playerID:l,gameName:r.name,numPlayers:a})):void 0!==s.server?this.transport=new Qt({store:this.store,gameID:u,playerID:l,gameName:r.name,numPlayers:a,server:s.server,socketOpts:c}):void 0!==s.transport&&(this.transport=new s.transport({store:this.store,gameID:u,playerID:l,gameName:r.name,numPlayers:a}))),this.createDispatchers()}return a(e,[{key:"subscribe",value:function(e){var t=this,n=function(){return e(t.getState())};this.transport.subscribe(n),this.subscribeCallback=n}},{key:"getState",value:function(){var e=this.store.getState();if(null===e)return e;var t=!0,n=this.game.flow.canPlayerMakeMove(e.G,e.ctx,this.playerID);this.multiplayer&&!n&&(t=!1),this.multiplayer||null===this.playerID||void 0===this.playerID||n||(t=!1),void 0!==e.ctx.gameover&&(t=!1);var r=u({},e,{isActive:t,G:this.game.playerView(e.G,e.ctx,this.playerID),log:this.log});return r=u({},r,{isConnected:this.transport.isConnected})}},{key:"connect",value:function(){this.transport.connect()}},{key:"createDispatchers",value:function(){this.moves=mr(this.game.moveNames,this.store,this.playerID,this.credentials,this.multiplayer),this.events=gr(this.game.flow.enabledEventNames,this.store,this.playerID,this.credentials,this.multiplayer)}},{key:"updatePlayerID",value:function(e){this.playerID=e,this.createDispatchers(),this.transport.updatePlayerID(e)}},{key:"updateGameID",value:function(e){this.gameID=e,this.createDispatchers(),this.transport.updateGameID(e)}},{key:"updateCredentials",value:function(e){this.credentials=e,this.createDispatchers()}}]),e}();function wr(e){return new br(e)}var kr=G(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&Symbol.for,r=n?Symbol.for("react.element"):60103,o=n?Symbol.for("react.portal"):60106,i=n?Symbol.for("react.fragment"):60107,a=n?Symbol.for("react.strict_mode"):60108,s=n?Symbol.for("react.profiler"):60114,c=n?Symbol.for("react.provider"):60109,u=n?Symbol.for("react.context"):60110,l=n?Symbol.for("react.async_mode"):60111,p=n?Symbol.for("react.concurrent_mode"):60111,h=n?Symbol.for("react.forward_ref"):60112,f=n?Symbol.for("react.suspense"):60113,d=n?Symbol.for("react.memo"):60115,y=n?Symbol.for("react.lazy"):60116;function v(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case r:switch(e=e.type){case l:case p:case i:case s:case a:case f:return e;default:switch(e=e&&e.$$typeof){case u:case h:case c:return e;default:return t}}case y:case d:case o:return t}}}function g(e){return v(e)===p}t.typeOf=v,t.AsyncMode=l,t.ConcurrentMode=p,t.ContextConsumer=u,t.ContextProvider=c,t.Element=r,t.ForwardRef=h,t.Fragment=i,t.Lazy=y,t.Memo=d,t.Portal=o,t.Profiler=s,t.StrictMode=a,t.Suspense=f,t.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===i||e===p||e===s||e===a||e===f||"object"==typeof e&&null!==e&&(e.$$typeof===y||e.$$typeof===d||e.$$typeof===c||e.$$typeof===u||e.$$typeof===h)},t.isAsyncMode=function(e){return g(e)||v(e)===l},t.isConcurrentMode=g,t.isContextConsumer=function(e){return v(e)===u},t.isContextProvider=function(e){return v(e)===c},t.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===r},t.isForwardRef=function(e){return v(e)===h},t.isFragment=function(e){return v(e)===i},t.isLazy=function(e){return v(e)===y},t.isMemo=function(e){return v(e)===d},t.isPortal=function(e){return v(e)===o},t.isProfiler=function(e){return v(e)===s},t.isStrictMode=function(e){return v(e)===a},t.isSuspense=function(e){return v(e)===f}});U(kr);kr.typeOf,kr.AsyncMode,kr.ConcurrentMode,kr.ContextConsumer,kr.ContextProvider,kr.Element,kr.ForwardRef,kr.Fragment,kr.Lazy,kr.Memo,kr.Portal,kr.Profiler,kr.StrictMode,kr.Suspense,kr.isValidElementType,kr.isAsyncMode,kr.isConcurrentMode,kr.isContextConsumer,kr.isContextProvider,kr.isElement,kr.isForwardRef,kr.isFragment,kr.isLazy,kr.isMemo,kr.isPortal,kr.isProfiler,kr.isStrictMode,kr.isSuspense;var xr=G(function(e,t){});U(xr);xr.typeOf,xr.AsyncMode,xr.ConcurrentMode,xr.ContextConsumer,xr.ContextProvider,xr.Element,xr.ForwardRef,xr.Fragment,xr.Lazy,xr.Memo,xr.Portal,xr.Profiler,xr.StrictMode,xr.Suspense,xr.isValidElementType,xr.isAsyncMode,xr.isConcurrentMode,xr.isContextConsumer,xr.isContextProvider,xr.isElement,xr.isForwardRef,xr.isFragment,xr.isLazy,xr.isMemo,xr.isPortal,xr.isProfiler,xr.isStrictMode,xr.isSuspense,G(function(e){e.exports=kr});var Cr=Object.getOwnPropertySymbols,Dr=Object.prototype.hasOwnProperty,Er=Object.prototype.propertyIsEnumerable;(function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map(function(e){return t[e]}).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach(function(e){r[e]=e}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(e){return!1}})()&&Object.assign;var Or="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";Function.call.bind(Object.prototype.hasOwnProperty);function Pr(){}function Ir(){}Ir.resetWarningCache=Pr;var _r=G(function(e){e.exports=function(){function e(e,t,n,r,o,i){if(i!==Or){var a=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw a.name="Invariant Violation",a}}function t(){return e}e.isRequired=e;var n={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:Ir,resetWarningCache:Pr};return n.PropTypes=n,n}()}),Mr=G(function(e){!function(t,n,r){if(t){for(var o,i={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},a={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},s={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},c={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},u=1;u<20;++u)i[111+u]="f"+u;for(u=0;u<=9;++u)i[u+96]=u.toString();y.prototype.bind=function(e,t,n){return e=e instanceof Array?e:[e],this._bindMultiple.call(this,e,t,n),this},y.prototype.unbind=function(e,t){return this.bind.call(this,e,function(){},t)},y.prototype.trigger=function(e,t){return this._directMap[e+":"+t]&&this._directMap[e+":"+t]({},e),this},y.prototype.reset=function(){return this._callbacks={},this._directMap={},this},y.prototype.stopCallback=function(e,t){if((" "+t.className+" ").indexOf(" mousetrap ")>-1)return!1;if(function e(t,r){return null!==t&&t!==n&&(t===r||e(t.parentNode,r))}(t,this.target))return!1;if("composedPath"in e&&"function"==typeof e.composedPath){var r=e.composedPath()[0];r!==e.target&&(t=r)}return"INPUT"==t.tagName||"SELECT"==t.tagName||"TEXTAREA"==t.tagName||t.isContentEditable},y.prototype.handleKey=function(){return this._handleKey.apply(this,arguments)},y.addKeycodes=function(e){for(var t in e)e.hasOwnProperty(t)&&(i[t]=e[t]);o=null},y.init=function(){var e=y(n);for(var t in e)"_"!==t.charAt(0)&&(y[t]=function(t){return function(){return e[t].apply(e,arguments)}}(t))},y.init(),t.Mousetrap=y,e.exports&&(e.exports=y)}function l(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n)}function p(e){if("keypress"==e.type){var t=String.fromCharCode(e.which);return e.shiftKey||(t=t.toLowerCase()),t}return i[e.which]?i[e.which]:a[e.which]?a[e.which]:String.fromCharCode(e.which).toLowerCase()}function h(e){return"shift"==e||"ctrl"==e||"alt"==e||"meta"==e}function f(e,t,n){return n||(n=function(){if(!o)for(var e in o={},i)e>95&&e<112||i.hasOwnProperty(e)&&(o[i[e]]=e);return o}()[e]?"keydown":"keypress"),"keypress"==n&&t.length&&(n="keydown"),n}function d(e,t){var n,r,o,i=[];for(n=function(e){return"+"===e?["+"]:(e=e.replace(/\+{2}/g,"+plus")).split("+")}(e),o=0;o<n.length;++o)r=n[o],c[r]&&(r=c[r]),t&&"keypress"!=t&&s[r]&&(r=s[r],i.push("shift")),h(r)&&i.push(r);return{key:r,modifiers:i,action:t=f(r,i,t)}}function y(e){var t=this;if(e=e||n,!(t instanceof y))return new y(e);t.target=e,t._callbacks={},t._directMap={};var r,o={},i=!1,a=!1,s=!1;function c(e){e=e||{};var t,n=!1;for(t in o)e[t]?n=!0:o[t]=0;n||(s=!1)}function u(e,n,r,i,a,s){var c,u,l,p,f=[],d=r.type;if(!t._callbacks[e])return[];for("keyup"==d&&h(e)&&(n=[e]),c=0;c<t._callbacks[e].length;++c)if(u=t._callbacks[e][c],(i||!u.seq||o[u.seq]==u.level)&&d==u.action&&("keypress"==d&&!r.metaKey&&!r.ctrlKey||(l=n,p=u.modifiers,l.sort().join(",")===p.sort().join(",")))){var y=!i&&u.combo==a,v=i&&u.seq==i&&u.level==s;(y||v)&&t._callbacks[e].splice(c,1),f.push(u)}return f}function f(e,n,r,o){t.stopCallback(n,n.target||n.srcElement,r,o)||!1===e(n,r)&&(function(e){e.preventDefault?e.preventDefault():e.returnValue=!1}(n),function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}(n))}function v(e){"number"!=typeof e.which&&(e.which=e.keyCode);var n=p(e);n&&("keyup"!=e.type||i!==n?t.handleKey(n,function(e){var t=[];return e.shiftKey&&t.push("shift"),e.altKey&&t.push("alt"),e.ctrlKey&&t.push("ctrl"),e.metaKey&&t.push("meta"),t}(e),e):i=!1)}function g(e,t,n,a){function u(t){return function(){s=t,++o[e],clearTimeout(r),r=setTimeout(c,1e3)}}function l(t){f(n,t,e),"keyup"!==a&&(i=p(t)),setTimeout(c,10)}o[e]=0;for(var h=0;h<t.length;++h){var y=h+1===t.length?l:u(a||d(t[h+1]).action);m(t[h],y,a,e,h)}}function m(e,n,r,o,i){t._directMap[e+":"+r]=n;var a,s=(e=e.replace(/\s+/g," ")).split(" ");s.length>1?g(e,s,n,r):(a=d(e,r),t._callbacks[a.key]=t._callbacks[a.key]||[],u(a.key,a.modifiers,{type:a.action},o,e,i),t._callbacks[a.key][o?"unshift":"push"]({callback:n,modifiers:a.modifiers,action:a.action,seq:o,level:i,combo:e}))}t._handleKey=function(e,t,n){var r,o=u(e,t,n),i={},l=0,p=!1;for(r=0;r<o.length;++r)o[r].seq&&(l=Math.max(l,o[r].level));for(r=0;r<o.length;++r)if(o[r].seq){if(o[r].level!=l)continue;p=!0,i[o[r].seq]=1,f(o[r].callback,n,o[r].combo,o[r].seq)}else p||f(o[r].callback,n,o[r].combo);var d="keypress"==n.type&&a;n.type!=s||h(e)||d||c(i),a=p&&"keydown"==n.type},t._bindMultiple=function(e,t,n){for(var r=0;r<e.length;++r)m(e[r],t,n)},l(e,"keypress",v),l(e,"keydown",v),l(e,"keyup",v)}}("undefined"!=typeof window?window:null,"undefined"!=typeof window?document:null)});var Sr=function(e){return n.createElement("div",{className:"gameinfo-item"},n.createElement("strong",null,e.name," "),n.createElement("div",null,JSON.stringify(e.value)))};Sr.propTypes={name:_r.string.isRequired,value:_r.any};var Ar=function(e){return n.createElement("section",{className:"gameinfo"},n.createElement(Sr,{name:"gameID",value:e.gameID}),n.createElement(Sr,{name:"playerID",value:e.playerID}),n.createElement(Sr,{name:"isActive",value:e.isActive}),e.isMultiplayer&&n.createElement("span",null,n.createElement(Sr,{name:"isConnected",value:e.isConnected}),n.createElement(Sr,{name:"isMultiplayer",value:e.isMultiplayer})))};function Tr(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css","top"===n&&r.firstChild?r.insertBefore(o,r.firstChild):r.appendChild(o),o.styleSheet?o.styleSheet.cssText=e:o.appendChild(document.createTextNode(e))}}Ar.propTypes={gameID:_r.string,playerID:_r.string,isActive:_r.bool,isConnected:_r.bool,isMultiplayer:_r.bool};Tr("/*\n * Copyright 2017 The boardgame.io Authors\n *\n * Use of this source code is governed by a MIT-style\n * license that can be found in the LICENSE file or at\n * https://opensource.org/licenses/MIT.\n */\n\n.debug-ui {\n  text-align: left;\n  overflow-x: hidden;\n  overflow-y: scroll;\n  background: #fefefe;\n  border-left: 1px solid #ddd;\n  box-shadow: -1px 0 10px #aaa;\n  position: absolute;\n  width: 300px;\n  right: 0;\n  top: 0;\n  height: 100%;\n  font-family: monospace;\n  font-size: 14px;\n  z-index: 9999;\n}\n\n#debug-controls.docktop {\n  position: fixed;\n  display: flex;\n  flex-direction: row;\n  justify-content: space-evenly;\n  align-items: center;\n  padding-left: 10px;\n  padding-right: 10px;\n  min-width: 500px;\n  top: 0;\n  right: 300px;\n  height: 50px;\n  background: #fff;\n  box-shadow: -3px 3px 3px #ccc;\n}\n\n@media only screen and (max-device-width: 750px) {\n  .debug-ui {\n    display: none;\n  }\n}\n\n.debug-ui .gameinfo {\n  background: #ddd;\n  position: fixed;\n  bottom: 0;\n  box-sizing: border-box;\n  width: 285px;\n  margin-left: -20px;\n  margin-bottom: 0;\n  padding: 10px;\n}\n\n.debug-ui .gameinfo-item div {\n  float: right;\n  text-align: right;\n}\n\n.debug-ui .ai-visualization {\n  position: fixed;\n  opacity: 100%;\n  right: 300px;\n  height: 100%;\n  width: 100%;\n  max-width: 3000px;\n  background: #fafafa;\n  border-right: 1px solid #ddd;\n}\n\n.debug-ui .pane {\n  float: left;\n  padding: 20px;\n  box-sizing: border-box;\n  min-width: 300px;\n  max-width: 400px;\n  opacity: 0.8;\n}\n\n.debug-ui section {\n  margin-bottom: 20px;\n}\n\n.debug-ui textarea {\n  resize: none;\n}\n\n.debug-ui .move {\n  cursor: pointer;\n  margin-bottom: 10px;\n  color: #666;\n}\n\n.debug-ui .move:hover {\n  color: #333;\n}\n\n.debug-ui .move.active {\n  color: #111;\n  font-weight: bold;\n}\n\n.debug-ui .move-error {\n  color: #a00;\n  font-weight: bold;\n}\n\n.debug-ui .arg-field {\n  outline: none;\n  font-family: monospace;\n}\n\n.debug-ui .key {\n  margin-bottom: 5px;\n}\n\n.debug-ui .key-box {\n  display: inline-block;\n  cursor: pointer;\n  min-width: 10px;\n  padding-left: 5px;\n  padding-right: 5px;\n  height: 20px;\n  line-height: 20px;\n  text-align: center;\n  border: 1px solid #ccc;\n  box-shadow: 1px 1px 1px #888;\n  background: #eee;\n  color: #444;\n}\n\n.debug-ui .key-box:hover {\n  background: #ddd;\n}\n\n.debug-ui .key.active .key-box {\n  background: #ddd;\n  border: 1px solid #999;\n  box-shadow: none;\n}\n\n.debug-ui .key-child {\n  display: inline-block;\n  height: 20px;\n  margin-left: 10px;\n}\n\n.debug-ui .menu {\n  display: flex;\n  flex-direction: row;\n  justify-content: center;\n}\n\n.debug-ui .menu .item {\n  cursor: pointer;\n  margin-top: -10px;\n  margin-bottom: 20px;\n  margin-right: 10px;\n  padding: 5px;\n  min-width: 50px;\n  text-align: center;\n}\n\n.debug-ui .menu .item.active {\n  font-weight: bold;\n  border-bottom: 3px solid #ccc;\n}\n\n.debug-ui .player-box {\n  display: flex;\n  flex-direction: row;\n}\n\n.debug-ui .player {\n  cursor: pointer;\n  text-align: center;\n  width: 30px;\n  height: 30px;\n  line-height: 30px;\n  background: #eee;\n  border: 3px solid #fff;\n  box-sizing: content-box;\n}\n\n.debug-ui .player.current {\n  background: #555;\n  color: #eee;\n  font-weight: bold;\n}\n\n.debug-ui .player.active {\n  border: 3px solid #ff7f50;\n}\n");var jr=function(e){function t(){var e,n;o(this,t);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return s(d(d(n=y(this,(e=p(t)).call.apply(e,[this].concat(i))))),"state",{active:!1}),s(d(d(n)),"deactivate",function(){n.setState({active:!1})}),s(d(d(n)),"activate",function(){n.setState({active:!0}),n.props.onPress&&(n.props.onPress(),n.setState({active:!1}))}),n}return l(t,n.Component),a(t,[{key:"componentDidMount",value:function(){var e=this;Mr.bind(this.props.value,function(t){t.preventDefault(),e.activate()})}},{key:"componentWillUnmount",value:function(){Mr.unbind(this.props.value)}},{key:"render",value:function(){var e=this.props.children;r(this.props.children)===r(this)&&(e=n.cloneElement(this.props.children,{active:this.state.active,deactivate:this.deactivate,activate:this.activate}));var t="key";return this.state.active&&(t+=" active"),n.createElement("div",{className:t},n.createElement("div",{className:"key-box",onClick:this.activate},this.props.value),n.createElement("div",{className:"key-child"},e))}}]),t}();s(jr,"propTypes",{value:_r.string.isRequired,children:_r.any,onPress:_r.func});var Rr=function(e){var t=null;e.step&&(t=[n.createElement(jr,{key:"4",value:"4",onPress:e.step},"step"),n.createElement(jr,{key:"5",value:"5",onPress:e.simulate},"simulate")]);var r="controls";e.dockTop&&(r+=" docktop"),e.help&&(r+=" help");var o=e.help&&!e.dockTop?"block":"none";return n.createElement("section",{id:"debug-controls",style:null,className:r},n.createElement(jr,{value:"1",onPress:e.reset},"reset"),n.createElement(jr,{value:"2",onPress:e.save},"save"),n.createElement(jr,{value:"3",onPress:e.restore},"restore"),t,e.dockTop||n.createElement(jr,{value:"?",onPress:e.toggleHelp},"show more"),n.createElement("div",{className:"key",style:{display:o}},n.createElement("div",{className:"key-box"},"d")," show/hide this pane"),n.createElement("div",{className:"key",style:{display:o}},n.createElement("div",{className:"key-box"},"l")," show/hide log"),n.createElement("div",{className:"key",style:{display:o}},n.createElement("div",{className:"key-box"},"i")," show/hide game info tab"),n.createElement("div",{className:"key",style:{display:o}},n.createElement("div",{className:"key-box"},"t")," dock controls"))};Rr.propTypes={help:_r.bool,toggleHelp:_r.func,step:_r.func,simulate:_r.func,reset:_r.func,save:_r.func,restore:_r.func,dockTop:_r.bool};var Nr=function(e){function t(){var e,n;o(this,t);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return s(d(d(n=y(this,(e=p(t)).call.apply(e,[this].concat(i))))),"onClick",function(e){var t=e==n.props.playerID?null:e;n.props.onClick(t)}),n}return l(t,n.Component),a(t,[{key:"render",value:function(){for(var e=this,t=[],r=function(r){var o=r+"",i="player";o===e.props.ctx.currentPlayer&&(i+=" current"),o===e.props.playerID&&(i+=" active"),t.push(n.createElement("div",{className:i,key:r,onClick:function(){return e.onClick(o)}},o))},o=0;o<this.props.ctx.numPlayers;o++)r(o);return n.createElement("div",{className:"player-box"},t)}}]),t}();s(Nr,"propTypes",{ctx:_r.any.isRequired,playerID:_r.any,onClick:_r.func});var Br=function(e){function t(){var e,n;o(this,t);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return s(d(d(n=y(this,(e=p(t)).call.apply(e,[this].concat(i))))),"state",{error:""}),s(d(d(n)),"onSubmit",function(e){var t="";try{var r=new Function("return [".concat(e,"]"))();n.props.fn.apply(d(d(n)),r)}catch(e){t=""+e}n.setState({error:t,focus:!1,enterArg:!1})}),n}return l(t,n.Component),a(t,[{key:"render",value:function(){return n.createElement("div",null,n.createElement(jr,{value:this.props.shortcut},n.createElement(zr,{name:this.props.name,onSubmit:this.onSubmit})),this.state.error?n.createElement("span",{className:"move-error"},this.state.error):null)}}]),t}();s(Br,"propTypes",{name:_r.string.isRequired,shortcut:_r.string.isRequired,fn:_r.func.isRequired});var zr=function(e){function t(){var e,n;o(this,t);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return s(d(d(n=y(this,(e=p(t)).call.apply(e,[this].concat(i))))),"onKeyDown",function(e){if("Enter"==e.key){e.preventDefault();var t=n.span.innerText;n.props.onSubmit(t),n.span.innerText="",n.props.deactivate()}"Escape"==e.key&&(e.preventDefault(),n.props.deactivate())}),n}return l(t,n.Component),a(t,[{key:"componentDidUpdate",value:function(){this.props.active?this.span.focus():this.span.blur()}},{key:"render",value:function(){var e=this,t="move";return this.props.active&&(t+=" active"),n.createElement("div",{className:t,onClick:this.props.activate},this.props.name,"(",n.createElement("span",{ref:function(t){e.span=t},className:"arg-field",onBlur:this.props.deactivate,onKeyDown:this.onKeyDown,contentEditable:!0}),")")}}]),t}();s(zr,"propTypes",{name:_r.string.isRequired,onSubmit:_r.func.isRequired,active:_r.bool,activate:_r.func,deactivate:_r.func});Tr("/*\n * Copyright 2017 The boardgame.io Authors\n *\n * Use of this source code is governed by a MIT-style\n * license that can be found in the LICENSE file or at\n * https://opensource.org/licenses/MIT.\n */\n\n.gamelog {\n  display: grid;\n  grid-template-columns: 30px 1fr 30px;\n  grid-auto-rows: auto;\n  grid-auto-flow: column;\n}\n\n.gamelog .turn-marker {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  grid-column: 1;\n  background: #555;\n  color: #eee;\n  text-align: center;\n  font-weight: bold;\n  border: 1px solid #888;\n}\n\n.gamelog .log-event {\n  grid-column: 2;\n  cursor: pointer;\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  background: #fff;\n  border: 1px dotted #ccc;\n  border-left: 5px solid #ccc;\n  padding: 5px;\n  text-align: center;\n  color: #888;\n  font-size: 14px;\n  min-height: 25px;\n  line-height: 25px;\n}\n\n.gamelog .phase-marker {\n  grid-column: 3;\n  background: #555;\n  border: 1px solid #888;\n  color: #eee;\n  text-align: center;\n  font-weight: bold;\n  padding-top: 10px;\n  padding-bottom: 10px;\n  text-orientation: sideways;\n  writing-mode: vertical-rl;\n  line-height: 30px;\n  width: 100%;\n}\n\n.gamelog.pinned .log-event {\n  opacity: 0.2;\n}\n\n.gamelog .log-event:hover {\n  border-style: solid;\n  background: #eee;\n}\n\n.gamelog .log-event.pinned {\n  border-style: solid;\n  background: #eee;\n  opacity: 1;\n}\n\n.gamelog div.player0 {\n  border-left-color: #ff851b;\n}\n\n.gamelog div.player1 {\n  border-left-color: #7fdbff;\n}\n\n.gamelog div.player2 {\n  border-left-color: #0074d9;\n}\n\n.gamelog div.player3 {\n  border-left-color: #39cccc;\n}\n\n.gamelog div.player4 {\n  border-left-color: #3d9970;\n}\n\n.gamelog div.player5 {\n  border-left-color: #2ecc40;\n}\n\n.gamelog div.player6 {\n  border-left-color: #01ff70;\n}\n\n.gamelog div.player7 {\n  border-left-color: #ffdc00;\n}\n\n.gamelog div.player8 {\n  border-left-color: #001f3f;\n}\n\n.gamelog div.player9 {\n  border-left-color: #ff4136;\n}\n\n.gamelog div.player10 {\n  border-left-color: #85144b;\n}\n\n.gamelog div.player11 {\n  border-left-color: #f012be;\n}\n\n.gamelog div.player12 {\n  border-left-color: #b10dc9;\n}\n\n.gamelog div.player13 {\n  border-left-color: #111111;\n}\n\n.gamelog div.player14 {\n  border-left-color: #aaaaaa;\n}\n\n.gamelog div.player15 {\n  border-left-color: #dddddd;\n}\n");var Lr=function(e){var t=void 0!==e.payload?JSON.stringify(e.payload,null,4):"";return n.createElement("div",null,t)};Lr.propTypes={payload:_r.any};var Fr=function(e){var t=e.action,r=t.payload.args||[],o=t.payload.playerID,i="log-event player".concat(o);e.pinned&&(i+=" pinned");var a=void 0!==e.payloadComponent?n.createElement(e.payloadComponent,{payload:e.payload}):n.createElement(Lr,{payload:e.payload});return n.createElement("div",{className:i,onClick:function(){return e.onLogClick(e.logIndex)},onMouseEnter:function(){return e.onMouseEnter(e.logIndex)},onMouseLeave:function(){return e.onMouseLeave()}},n.createElement("div",null,t.payload.type,"(",r.join(","),")"),a)};Fr.propTypes={action:_r.any.isRequired,logIndex:_r.number.isRequired,onLogClick:_r.func.isRequired,onMouseEnter:_r.func.isRequired,onMouseLeave:_r.func.isRequired,pinned:_r.bool,payload:_r.object,payloadComponent:_r.oneOfType([_r.element,_r.func])};var qr=function(e){return n.createElement("div",{className:"turn-marker",style:{gridRow:"span "+e.numEvents}},e.turn)};qr.propTypes={turn:_r.number.isRequired,numEvents:_r.number.isRequired};var Ur=function(e){return n.createElement("div",{className:"phase-marker",style:{gridRow:"span "+e.numEvents}},e.phase)};Ur.propTypes={phase:_r.string.isRequired,numEvents:_r.number.isRequired};var Gr=function(e){function t(){var e,n;o(this,t);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return s(d(d(n=y(this,(e=p(t)).call.apply(e,[this].concat(i))))),"state",{pinned:null}),s(d(d(n)),"rewind",function(e){for(var t=n.props.initialState,r=0;r<n.props.log.length;r++){var o=n.props.log[r].action;if(o.automatic||(t=n.props.reducer(t,o)),o.type==E){if(0==e)break;e--}}return{G:t.G,ctx:t.ctx}}),s(d(d(n)),"onLogClick",function(e){n.setState(function(t){var r=n.rewind(e),o=n.props.log.filter(function(e){return e.action.type==E})[e].action.payload.metadata;return t.pinned===e?(n.props.onHover({logIndex:e,state:r,metadata:void 0}),{pinned:null}):(n.props.onHover({logIndex:e,state:r,metadata:o}),{pinned:e})})}),s(d(d(n)),"onMouseEnter",function(e){if(null===n.state.pinned){var t=n.rewind(e);n.props.onHover({logIndex:e,state:t})}}),s(d(d(n)),"onMouseLeave",function(){null===n.state.pinned&&n.props.onHover({state:null})}),n}return l(t,n.Component),a(t,[{key:"render",value:function(){for(var e=[],t=[],r=[],o=0,i=0,a=this.props.log.filter(function(e){return e.action.type==E}),s=0;s<a.length;s++){var c=a[s],u=c.action,l=c.payload,p=c.turn,h=c.phase;o++,i++,e.push(n.createElement(Fr,{key:s,pinned:s===this.state.pinned,logIndex:s,onLogClick:this.onLogClick,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,action:u,payload:l,payloadComponent:this.props.payloadComponent})),s!=a.length-1&&a[s+1].turn==p||(t.push(n.createElement(qr,{key:t.length,turn:p,numEvents:i})),i=0),s!=a.length-1&&a[s+1].phase==h||(r.push(n.createElement(Ur,{key:r.length,phase:h,numEvents:o})),o=0)}var f="gamelog";return null!==this.state.pinned&&(f+=" pinned"),n.createElement("div",{className:f},t,e,r)}}]),t}();s(Gr,"propTypes",{onHover:_r.func,reducer:_r.func,initialState:_r.any.isRequired,log:_r.array.isRequired,payloadComponent:_r.oneOfType([_r.element,_r.func])}),s(Gr,"defaultProps",{onHover:function(){}});var Hr=function(e){function t(e){var n;return o(this,t),s(d(d(n=y(this,p(t).call(this,e)))),"saveState",function(){var e=rn(n.props.gamestate);window.localStorage.setItem("gamestate",e)}),s(d(d(n)),"restoreState",function(){var e=window.localStorage.getItem("gamestate");if(null!==e){var t=nn(e);n.props.store.dispatch(R(t))}}),s(d(d(n)),"onClickMain",function(){n.setState({showLog:!1})}),s(d(d(n)),"onClickLog",function(){n.setState({showLog:!0})}),s(d(d(n)),"toggleHelp",function(){n.setState(function(e){return{help:!e.help}})}),s(d(d(n)),"onLogHover",function(e){var t=e.state,r=e.metadata;n.setState({AIMetadata:r}),n.props.overrideGameState(t)}),s(d(d(n)),"simulate",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e4,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;return async function(){for(var r=0;r<e&&await n.props.step();r++)await new Promise(function(e){return setTimeout(e,t)})}()}),n.shortcuts=function(e,t,n){var r={},o={};for(var i in e)o[i]=i;for(var a in t)o[a]=a;for(var s={},c=0;c<n.length;c++)s[n[c]]=!0;var u=s,l=!0;for(var p in o){var h=p[0];if(u[h]){l=!1;break}u[h]=!0,r[p]=h}if(l)return r;u=s;var f=97;for(var d in r={},o){for(var y=String.fromCharCode(f);u[y];)f++,y=String.fromCharCode(f);u[y]=!0,r[d]=y}return r}(e.moves,e.events,"dlit"),n.state={showDebugUI:!1,showLog:!1,showGameInfo:e.showGameInfo,dockControls:e.dockControls,help:!1,AIMetadata:null},n}return l(t,n.Component),a(t,[{key:"componentDidMount",value:function(){var e=this;Mr.bind("d",function(t){t.preventDefault(),e.setState(function(e){return{showDebugUI:!e.showDebugUI}})}),Mr.bind("l",function(t){t.preventDefault(),e.setState(function(e){return{showLog:!e.showLog}})}),Mr.bind("i",function(t){t.preventDefault(),e.setState(function(e){return{showGameInfo:!e.showGameInfo}})}),Mr.bind("t",function(t){t.preventDefault(),e.setState(function(e){return{dockControls:!e.dockControls}})})}},{key:"componentWillUnmount",value:function(){Mr.unbind("d"),Mr.unbind("l"),Mr.unbind("i"),Mr.unbind("t")}},{key:"render",value:function(){if(!this.state.showDebugUI)return null;var e=[];for(var t in this.props.moves){var r=this.props.moves[t],o=this.shortcuts[t];e.push(n.createElement(Br,{key:t,name:t,fn:r,shortcut:o}))}var i=[];for(var a in this.props.events){var s=this.props.events[a],c=this.shortcuts[a];i.push(n.createElement(Br,{key:a,name:a,fn:s,shortcut:c}))}var u=this.state.AIMetadata&&this.props.visualizeAI,l="debug-ui";return this.state.dockControls&&(l+=" docktop"),n.createElement("div",{className:l},u&&n.createElement("div",{className:"ai-visualization"},this.props.visualizeAI(this.state.AIMetadata)),n.createElement("div",{className:"pane"},n.createElement("div",{className:"menu"},n.createElement("div",{className:this.state.showLog?"item":"item active",onClick:this.onClickMain},"Main"),n.createElement("div",{className:this.state.showLog?"item active":"item",onClick:this.onClickLog},"Log")),this.state.showLog||n.createElement("span",null,this.state.showGameInfo&&n.createElement(Ar,{gameID:this.props.gameID,playerID:this.props.playerID,isActive:this.props.gamestate.isActive,isConnected:this.props.gamestate.isConnected,isMultiplayer:this.props.isMultiplayer}),n.createElement(Rr,{dockTop:this.state.dockControls,help:this.state.help,toggleHelp:this.toggleHelp,step:this.props.step,simulate:this.simulate,reset:this.props.reset,save:this.saveState,restore:this.restoreState}),n.createElement("h3",null,"Players"),n.createElement(Nr,{ctx:this.props.gamestate.ctx,playerID:this.props.playerID,onClick:this.props.updatePlayerID}),n.createElement("h3",null,"Moves"),n.createElement("section",null,e),n.createElement("h3",null,"Events"),n.createElement("section",null,i),n.createElement("section",null,n.createElement("pre",{className:"json"},n.createElement("strong",null,"G"),":"," ",JSON.stringify(this.props.gamestate.G,null,2))),n.createElement("section",null,n.createElement("pre",{className:"json"},n.createElement("strong",null,"ctx"),":"," ",JSON.stringify(function(e){var t={};for(var n in e)n.startsWith("_")||(t[n]=e[n]);return t}(this.props.gamestate.ctx),null,2)))),this.state.showLog&&n.createElement("section",null,n.createElement(Gr,{onHover:this.onLogHover,reducer:this.props.reducer,log:this.props.gamestate.log,initialState:this.props.gamestate._initial}))))}}]),t}();s(Hr,"propTypes",{gamestate:_r.shape({G:_r.any.isRequired,ctx:_r.any.isRequired,log:_r.array.isRequired,isActive:_r.bool,isConnected:_r.bool,_initial:_r.any.isRequired}),gameID:_r.string.isRequired,playerID:_r.string,isMultiplayer:_r.bool,moves:_r.any,events:_r.any,restore:_r.func,showLog:_r.bool,store:_r.any,step:_r.func,reset:_r.func,reducer:_r.func,overrideGameState:_r.func,visualizeAI:_r.func,updateGameID:_r.func,updatePlayerID:_r.func,updateCredentials:_r.func,showGameInfo:_r.bool,dockControls:_r.bool}),s(Hr,"defaultProps",{showGameInfo:!0,dockControls:!1});function Xr(e,t){return u({},e,{ctx:Yr(e.G,e.ctx,t)})}function Yr(e,t,n){var r=[];return n.value&&(r=n.value(e,t)),n.all&&(r=v(t.playOrder)),n.others&&(r=v(t.playOrder).filter(function(e){return e!==t.currentPlayer})),Array.isArray(n)&&(r=n),u({},t,{actionPlayers:r,_actionPlayersOnce:n.once||!1})}function Wr(e,t){return e[t]+""}function Kr(e,t,n){var r=v(new Array(t.numPlayers)).map(function(e,t){return t+""});void 0!==n.playOrder&&(r=n.playOrder(e,t));var o=n.first(e,t),i=Wr(r,o);return t=void 0!==n.actionPlayers?Yr(e,t,n.actionPlayers):u({},t,{actionPlayers:[i]}),u({},t,{currentPlayer:i,playOrderPos:o,playOrder:r})}var Vr={DEFAULT:{first:function(e,t){return t.playOrderPos},next:function(e,t){return(t.playOrderPos+1)%t.playOrder.length}},ONCE:{first:function(){return 0},next:function(e,t){if(t.playOrderPos<t.playOrder.length-1)return t.playOrderPos+1}},ANY:{first:function(e,t){return t.playOrderPos},next:function(e,t){return t.playOrderPos},actionPlayers:{all:!0}},ANY_ONCE:{first:function(e,t){return t.playOrderPos},next:function(e,t){return t.playOrderPos},actionPlayers:{all:!0,once:!0},endPhaseOnceDone:!0},OTHERS:{first:function(e,t){return t.playOrderPos},next:function(e,t){return t.playOrderPos},actionPlayers:{others:!0}},OTHERS_ONCE:{first:function(e,t){return t.playOrderPos},next:function(e,t){return t.playOrderPos},actionPlayers:{others:!0,once:!0},endPhaseOnceDone:!0},CUSTOM:function(e){return{playOrder:function(){return e},first:function(){return 0},next:function(e,t){return(t.playOrderPos+1)%t.playOrder.length}}},CUSTOM_FROM:function(e){return{playOrder:function(t){return t[e]},first:function(){return 0},next:function(e,t){return(t.playOrderPos+1)%t.playOrder.length}}},SKIP:{first:function(e,t){return t.playOrderPos},next:function(e,t){if(!e.allPassed)for(var n=t.playOrderPos,r=0;r<t.playOrder.length;r++)if(n=(n+1)%t.playOrder.length,!e.passOrder.includes(t.playOrder[n]+""))return n}}};function $r(e){var t=e.ctx,n=e.events,r=e.enabledEvents,o=e.init,i=e.processMove,a=e.optimisticUpdate,s=e.canMakeMove,c=e.canUndoMove,l=e.redactedMoves;t||(t=function(){return{}}),n||(n={}),r||(r={}),o||(o=function(e){return e}),i||(i=function(e){return e}),s||(s=function(){return!0}),c||(c=function(){return!0}),void 0===a&&(a=function(){return!0});var p=function e(t,r){var o=r.payload;if(n.hasOwnProperty(o.type)){var i={playerID:o.playerID,dispatch:e},a={action:r,_stateID:t._stateID,turn:t.ctx.turn,phase:t.ctx.phase},s=[t=u({},t,{deltalog:[].concat(v(t.deltalog||[]),[a])})].concat(o.args);return n[o.type].apply(i,s)}return t};return{ctx:t,init:o,canUndoMove:c,redactedMoves:l,eventNames:Object.getOwnPropertyNames(n),enabledEventNames:Object.getOwnPropertyNames(r),processMove:function(e,t){return i(e,t,p)},processGameEvent:function(e,t){return p(e,t)},optimisticUpdate:a,canPlayerCallEvent:function(e,t,n){return t.currentPlayer==n&&t.actionPlayers.includes(n)},canPlayerMakeMove:function(e,t,n){return(t.actionPlayers||[]).includes(n)},canMakeMove:function(e,t,n){return void 0===t.gameover&&s(e,t,n)}}}function Jr(e){var t=e.phases,n=e.startingPhase,r=e.movesPerTurn,o=e.endTurnIf,i=e.endGameIf,a=e.onTurnBegin,c=e.onTurnEnd,l=e.onMove,p=e.turnOrder,h=e.endTurn,f=e.endPhase,d=e.endGame,y=e.setActionPlayers,g=e.undoableMoves,m=e.allowedMoves,b=e.redactedMoves,w=e.optimisticUpdate,k=e.game;void 0===f&&t&&(f=!0),void 0===h&&(h=!0),void 0===d&&(d=!1),void 0===y&&(y=!1),void 0===w&&(w=function(){return!0}),void 0===k&&(k={plugins:[]}),t||(t={}),n||(n="default"),o||(o=function(){return!1}),i||(i=function(){}),a||(a=function(e){return e}),c||(c=function(e){return e}),l||(l=function(e){return e}),p||(p=Vr.DEFAULT),void 0===m&&(m=null),void 0===g&&(g=null);var x=t;for(var C in x.default={},x){var D=x[C];void 0===D.endPhaseIf&&(D.endPhaseIf=function(){}),void 0===D.onPhaseBegin&&(D.onPhaseBegin=function(e){return e}),D.onPhaseBegin=tr(D.onPhaseBegin,k),void 0===D.onPhaseEnd&&(D.onPhaseEnd=function(e){return e}),D.onPhaseEnd=tr(D.onPhaseEnd,k),void 0===D.movesPerTurn&&(D.movesPerTurn=r),void 0===D.endTurnIf&&(D.endTurnIf=o),void 0===D.endGameIf&&(D.endGameIf=i),void 0===D.onTurnBegin&&(D.onTurnBegin=a),D.onTurnBegin=tr(D.onTurnBegin,k),void 0===D.onTurnEnd&&(D.onTurnEnd=c),D.onTurnEnd=tr(D.onTurnEnd,k),void 0===D.onMove&&(D.onMove=l),D.onMove=tr(D.onMove,k),void 0===D.turnOrder&&(D.turnOrder=p),void 0===D.undoableMoves&&(D.undoableMoves=g),void 0===D.allowedMoves&&(D.allowedMoves=m),"function"!=typeof D.allowedMoves&&function(){var e=D.allowedMoves;D.allowedMoves=function(){return e}}()}var E=function(e){var t=e.G,n=e.ctx;return x[n.phase].endPhaseIf(t,n)},O=function(e){var t=e.G,n=e.ctx,r=x[n.phase],o=n.stats.turn.numMoves[n.currentPlayer]||0;return!!(r.movesPerTurn&&o>=r.movesPerTurn)||r.endTurnIf(t,n)},P=function(e,t){var n=t.onPhaseBegin(e.G,e.ctx),r=Kr(n,e.ctx,t.turnOrder);return n=nr.onPhaseBegin(n,r,k),(r=rr.onPhaseBegin(r,k)).stats=u({},r.stats,{phase:u({},r.stats.phase,{numMoves:{},allPlayed:!1})}),u({},e,{G:n,ctx:u({},r,{allowedMoves:t.allowedMoves(n,r)})})},I=function(e,t){var n=t.onTurnBegin(e.G,e.ctx),r=[{G:n,ctx:ar.detachAllFromContext(e.ctx)}],o=u({},e.ctx);return o.allowedMoves=t.allowedMoves(n,o),o.stats=u({},o.stats,{turn:u({},o.stats.turn,{numMoves:{},allPlayed:!1})}),u({},e,{G:n,ctx:o,_undo:r,_redo:[]})};function _(e,t,n){var r=(e.ctx.stats[t].numMoves[n]||0)+1,o=u({},e.ctx.stats[t].numMoves,s({},n,r)),i=u({},e.ctx.stats[t],{numMoves:o});Object.keys(o).length==e.ctx.numPlayers&&(i.allPlayed=!0);var a=u({},e.ctx.stats,s({},t,i)),c=u({},e.ctx,{stats:a});return u({},e,{ctx:c})}var M={endTurn:function(e,t){var n=e,r=n.G,o=n.ctx,i=x[o.phase],a=o.stats.turn.numMoves[o.currentPlayer]||0;if(i.movesPerTurn&&a<i.movesPerTurn)return e;r=i.onTurnEnd(r,o);var s=i.endGameIf(r,o);if(void 0!==s)return u({},e,{G:r,ctx:u({},o,{gameover:s})});var c=!1,l=function(e,t,n,r){var o=t.playOrderPos,i=t.currentPlayer,a=t.actionPlayers,s=!1;if(r&&!0!==r)t.playOrder.includes(r.next)&&(o=t.playOrder.indexOf(r.next),a=[i=r.next]);else{var c=n.next(e,t);void 0===c?s=!0:(o=c,i=Wr(t.playOrder,o),void 0===n.actionPlayers&&(a=[i]))}return{endPhase:s,ctx:t=u({},t,{playOrderPos:o,currentPlayer:i,actionPlayers:a})}}(r,o,i.turnOrder,t);c=l.endPhase,o=u({},o=l.ctx,{turn:o.turn+1}),e=u({},e,{G:r,ctx:o});var p=E(e);return p&&(c=!0),c?this.dispatch(e,j("endPhase",[p],this.playerID)):I(e,i)},endPhase:function(e,t,n){var r=e.G,o=e.ctx,i=x[o.phase];r=i.onPhaseEnd(r,o);var a=i.endGameIf(r,o);if(void 0!==a)return u({},e,{G:r,ctx:u({},o,{gameover:a})});var s=o.phase;t&&!0!==t?t.next in x&&(o=u({},o,{phase:t.next,prevPhase:s})):o=void 0!==i.next?u({},o,{phase:i.next,prevPhase:s}):u({},o,{phase:o.prevPhase,prevPhase:s});var c=(e=P(u({},e,{G:r,ctx:o}),x[o.phase])).ctx.turn;if(n||(n={}),o.phase in n)e=this.dispatch(e,j("endPhase",[{next:"default"},n],this.playerID));else{n[o.phase]=!0;var l=E(e);l&&(e=this.dispatch(e,j("endPhase",[l,n],this.playerID)))}var p=O(e);return p&&e.ctx.turn==c&&(e=this.dispatch(e,j("endTurn",[p],this.playerID))),e},endGame:function(e,t){return void 0===t&&(t=!0),u({},e,{ctx:u({},e.ctx,{gameover:t})})},setActionPlayers:Xr},S={};return h&&(S.endTurn=!0),f&&(S.endPhase=!0),d&&(S.endGame=!0),y&&(S.setActionPlayers=!0),$r({ctx:function(e){return{numPlayers:e,turn:0,currentPlayer:"0",actionPlayers:["0"],currentPlayerMoves:0,playOrder:v(new Array(e)).map(function(e,t){return t+""}),playOrderPos:0,stats:{turn:{numMoves:{}},phase:{numMoves:{}}},allPlayed:!1,phase:n,prevPhase:"default"}},init:function(e){return function(e){if(!(e.ctx.phase in x))return e.ctx.phase,e;var t=x[e.ctx.phase];return e=P(e,t),e=I(e,t)}(e)},optimisticUpdate:function(e,t,n){return(void 0===t._random||void 0===t._random.prngstate)&&w(e,t,n)},events:M,enabledEvents:S,processMove:function(e,t,n){var r=x[e.ctx.phase];e=_(e,"turn",t.playerID);var o=(e=_(e,"phase",t.playerID)).ctx.actionPlayers,i=!1;if(e.ctx._actionPlayersOnce){var a=t.playerID;0==(o=o.filter(function(e){return e!==a})).length&&r.turnOrder.endPhaseOnceDone&&(i=!0)}e=u({},e,{ctx:u({},e.ctx,{actionPlayers:o})});var s=(e=u({},e,{G:r.onMove(e.G,e.ctx,t)})).ctx.turn,c=r.endGameIf(e.G,e.ctx),l=E(e)||i;(l||void 0!==c)&&(e=n(e,j("endPhase",[l],t.playerID)),r=x[e.ctx.phase]);var p=O(e);if(e.ctx.turn!=s||!p&&void 0===c||(e=n(e,j("endTurn",[p],t.playerID))),void 0!==c)return u({},e,{ctx:u({},e.ctx,{gameover:c})});var h=r.allowedMoves(e.G,e.ctx);if(e=u({},e,{ctx:u({},e.ctx,{allowedMoves:h})}),!p){var f=e._undo||[],d=t.type,y=ar.detachAllFromContext(e.ctx);e=u({},e,{_undo:[].concat(v(f),[{G:e.G,ctx:y,moveType:d}]),_redo:[]})}return e},canMakeMove:function(e,t,n){var r=x[t.phase].allowedMoves(e,t);return!r||r.includes(n)},canUndoMove:function(e,t,n){var r=x[t.phase];return!r.undoableMoves||r.undoableMoves.includes(n)},redactedMoves:b})}var Zr=function(e){function t(){var e,r;o(this,t);for(var i=arguments.length,a=new Array(i),c=0;c<i;c++)a[c]=arguments[c];return s(d(d(r=y(this,(e=p(t)).call.apply(e,[this].concat(a))))),"_svgRef",n.createRef()),s(d(d(r)),"onClick",function(e){r.props.onClick&&r.props.onClick(e)}),s(d(d(r)),"onMouseOver",function(e){r.props.onMouseOver&&r.props.onMouseOver(e)}),s(d(d(r)),"onMouseOut",function(e){r.props.onMouseOut&&r.props.onMouseOut(e)}),r}return l(t,n.Component),a(t,[{key:"_getCellColor",value:function(e,t){var n="".concat(e,",").concat(t),r="white";return n in this.props.colorMap&&(r=this.props.colorMap[n]),r}},{key:"_getGrid",value:function(){if(!this.props.outline)return null;for(var e=[],t=0;t<this.props.cols;t++)for(var r=0;r<this.props.rows;r++)e.push(n.createElement(Qr,{key:this.props.cols*r+t,style:{fill:this._getCellColor(t,r)},x:t,y:r,size:this.props.cellSize,onClick:this.onClick,onMouseOver:this.onMouseOver,onMouseOut:this.onMouseOut}));return e}},{key:"render",value:function(){var e=this,t=n.Children.map(this.props.children,function(t){return n.cloneElement(t,{template:Qr,onClick:e.onClick,onMouseOver:e.onMouseOver,onMouseOut:e.onMouseOut,svgRef:e._svgRef})});return n.createElement("svg",{ref:this._svgRef,viewBox:"0 0 "+this.props.cols+" "+this.props.rows,style:this.props.style},n.createElement("g",null,this._getGrid()),t)}}]),t}();s(Zr,"propTypes",{rows:_r.number.isRequired,cols:_r.number.isRequired,outline:_r.bool,style:_r.object,colorMap:_r.object,cellSize:_r.number,onClick:_r.func,onMouseOver:_r.func,onMouseOut:_r.func,children:_r.oneOfType([_r.arrayOf(_r.element),_r.element])}),s(Zr,"defaultProps",{colorMap:{},outline:!0,cellSize:1});var Qr=function(e){function t(){var e,r;o(this,t);for(var i=arguments.length,a=new Array(i),c=0;c<i;c++)a[c]=arguments[c];return s(d(d(r=y(this,(e=p(t)).call.apply(e,[this].concat(a))))),"_gRef",n.createRef()),s(d(d(r)),"onClick",function(e){r.props.onClick(r.getCoords(),e)}),s(d(d(r)),"onMouseOver",function(e){r.props.onMouseOver(r.getCoords(),e)}),s(d(d(r)),"onMouseOut",function(e){r.props.onMouseOut(r.getCoords(),e)}),r}return l(t,n.Component),a(t,[{key:"getCoords",value:function(){return{x:this.props.x,y:this.props.y}}},{key:"componentDidMount",value:function(){var e=this._gRef.current,t=!0,n=!1,r=void 0;try{for(var o,i=this.props.eventListeners[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var a=o.value;e.addEventListener(a.name,a.callback)}}catch(e){n=!0,r=e}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}}},{key:"componentWillUnmount",value:function(){var e=this._gRef.current,t=!0,n=!1,r=void 0;try{for(var o,i=this.props.eventListeners[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var a=o.value;e.removeEventListener(a.name,a.callback)}}catch(e){n=!0,r=e}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}}},{key:"render",value:function(){var e=this.props.x*this.props.size,t=this.props.y*this.props.size,r=n.createElement("rect",{style:this.props.style,width:this.props.size,height:this.props.size,x:0,y:0});return this.props.children&&(r=this.props.children),n.createElement("g",{ref:this._gRef,onClick:this.onClick,onMouseOver:this.onMouseOver,onMouseOut:this.onMouseOut,transform:"translate(".concat(e,", ").concat(t,")")},r)}}]),t}();s(Qr,"propTypes",{x:_r.number.isRequired,y:_r.number.isRequired,size:_r.number,style:_r.any,onClick:_r.func,onMouseOver:_r.func,onMouseOut:_r.func,eventListeners:_r.array,children:_r.element}),s(Qr,"defaultProps",{size:1,x:0,y:0,style:{fill:"#fff"},eventListeners:[]});var eo=function(e){function t(e){var n;return o(this,t),s(d(d(n=y(this,p(t).call(this,e)))),"_startDrag",function(e){n.props.draggable&&n.props.shouldDrag(n.getCoords())&&(e.preventDefault(),e=e.touches?e.touches[0]:e,n.setState(u({},n.state,{dragged:{x:e.pageX,y:e.pageY}})),n._addOrRemoveDragEventListeners(!0))}),s(d(d(n)),"_drag",function(e){if(n.state.dragged){e.preventDefault(),e=e.touches?e.touches[0]:e;var t=n.props.svgRef.current.getScreenCTM().inverse(),r=e.pageX-n.state.dragged.x,o=e.pageY-n.state.dragged.y,i=t.a*r+t.b*o,a=t.c*r+t.d*o,s=n.state.x+i,c=n.state.y+a;n.props.onDrag&&n.props.onDrag({x:s,y:c,originalX:n.props.x,originalY:n.props.y}),n.setState(u({},n.state,{x:s,y:c,dragged:{x:e.pageX,y:e.pageY}}))}}),s(d(d(n)),"_endDrag",function(e){n.state.dragged&&(e.preventDefault(),Math.sqrt(Math.pow(n.state.x-n.props.x,2)+Math.pow(n.state.y-n.props.y,2))>.2?n.props.onDrop({x:n.state.x,y:n.state.y,originalX:n.props.x,originalY:n.props.y}):n.props.onClick({x:n.state.x,y:n.state.y}),n.setState(u({},n.state,{x:n.props.x,y:n.props.y,dragged:null})),n._addOrRemoveDragEventListeners(!1))}),s(d(d(n)),"_onClick",function(e){n.props.draggable&&n.props.shouldDrag(n.getCoords())||n.props.onClick(e)}),n.state=u({},n.getCoords(),{dragged:null,usingTouch:!1}),n}return l(t,n.Component),a(t,[{key:"componentWillUnmount",value:function(){this.state.dragged&&this._addOrRemoveDragEventListeners(!1)}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){var t=this.getCoords(),n=this.getCoords(e);t.x==n.x&&t.y==n.y||(this.setState(u({},this.state,{originTime:Date.now(),originX:this.state.x,originY:this.state.y,originZ:this.state.z})),requestAnimationFrame(this._animate(Date.now())))}},{key:"_addOrRemoveDragEventListeners",value:function(e){var t=this.props.svgRef.current;if(t){var n=t.addEventListener;e||(n=t.removeEventListener),n("touchmove",this._drag,{passive:!1}),n("mousemove",this._drag,{passive:!1}),n("mouseup",this._endDrag,{passive:!1}),n("mouseleave",this._endDrag,{passive:!1}),n("touchcancel",this._endDrag,{passive:!1}),n("touchleave",this._endDrag,{passive:!1}),n("touchend",this._endDrag,{passive:!1})}}},{key:"_animate",value:function(e){var t=this;return function(){var n=e-t.state.originTime,r=t.getCoords();if(n<t.props.animationDuration&&t.props.animate){var o=t._easeInOutCubic(n,0,1,t.props.animationDuration);t.setState(u({},t.state,{x:(r.x-t.state.originX)*o+t.state.originX,y:(r.y-t.state.originY)*o+t.state.originY,z:(r.z-t.state.originZ)*o+t.state.originZ})),requestAnimationFrame(t._animate(Date.now()))}else t.setState(u({},t.state,{x:r.x,y:r.y,z:r.z}))}.bind(this)}},{key:"getCoords",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props;return{x:e.x,y:e.y,z:e.z}}},{key:"_easeInOutCubic",value:function(e,t,n,r){return(e/=r/2)<1?n/2*e*e*e+t:n/2*((e-=2)*e*e+2)+t}},{key:"_eventListeners",value:function(){return[{name:"mousedown",callback:this._startDrag},{name:"touchstart",callback:this._startDrag}]}},{key:"render",value:function(){var e=this.props.template;return n.createElement(e,{x:this.state.x,y:this.state.y,z:this.state.z,style:this.props.style,onClick:this._onClick,onMouseOver:this.props.onMouseOver,onMouseOut:this.props.onMouseOut,eventListeners:this._eventListeners()},this.props.children)}}]),t}();s(eo,"propTypes",{x:_r.number,y:_r.number,z:_r.number,template:_r.any,style:_r.any,animate:_r.bool,onClick:_r.func,onMouseOver:_r.func,onMouseOut:_r.func,children:_r.element,animationDuration:_r.number,draggable:_r.bool,shouldDrag:_r.func,onDrag:_r.func,onDrop:_r.func,svgRef:_r.object}),s(eo,"defaultProps",{animationDuration:750,template:Qr});var to=n.createContext(),no=function(e){return n.createElement(to.Consumer,null,function(t){return n.createElement(ro,c({},e,{context:t}))})},ro=function(e){function r(e){var n;return o(this,r),s(d(d(n=y(this,p(r).call(this)))),"_attachMesh",function(e){var r=n.size,o=new t.Vector3,i=new t.Vector3,a=(new t.Box3).setFromObject(e);a.getSize(o),a.getCenter(i);var s=o.z<o.x?o.x:o.z;s=r/s,e.scale.set(s,s,s),n.props.boardSize&&n.props.lift&&n.props.padding?(e.position.x=n.props.x*(n.props.boardSize+n.props.padding),e.position.z=n.props.y*(n.props.boardSize+n.props.padding),e.position.y=-a.min.y+n.props.lift):(e.position.x=n.props.x,e.position.z=n.props.y,e.position.y=-a.min.y),n.parent.add(e);n.props.context.regCall(e,function(e){"click"==e.type?n.props.onClick({x:n.props.x,y:n.props.y}):"mouseOver"==e.type?n.props.onMouseOver({x:n.props.x,y:n.props.y}):"mouseOut"==e.type&&n.props.onMouseOut({x:n.props.x,y:n.props.y})})}),e.size?n.size=e.size:n.size=e.boardSize,e.parent?n.parent=e.parent:n.parent=e.context,n}return l(r,n.Component),a(r,[{key:"componentWillUnmount",value:function(){this.parent.remove(this.prevMesh)}},{key:"render",value:function(){var e=this.props.mesh;return this.prevMesh&&this.prevMesh===e?null:(e?e.isObject3D?this._attachMesh(e):console.error("Your input to tokens should be an three js 3d object"):(e=new t.Mesh(new t.BoxBufferGeometry(1,.3,1),new t.MeshLambertMaterial({color:"#eeeeee"})),this._attachMesh(e)),this.parent.remove(this.prevMesh),this.prevMesh=e,null)}}]),r}();s(ro,"propTypes",{x:_r.number,y:_r.number,z:_r.number,mesh:_r.any,padding:_r.number,size:_r.number,lift:_r.number,boardSize:_r.number,parent:_r.instanceOf(t.Object3D),context:_r.object,animate:_r.bool,onClick:_r.func,onMouseOver:_r.func,onMouseOut:_r.func,children:_r.element,animationDuration:_r.number}),s(ro,"defaultProps",{animationDuration:750,size:1,padding:.1,lift:.1});var oo=function(e){return e.three?n.createElement(no,e,e.children):n.createElement(eo,e,e.children)};oo.propTypes={three:_r.bool,children:_r.any};var io=function(e){var t=e.width,r=e.height;return n.createElement("svg",{width:t||128,height:r||128,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 128 128"},n.createElement("path",{d:"M64,120.37,15.27,92.28V35.91L64,7.82l48.73,28.09V92.28Z",fill:"#373748"}),n.createElement("path",{fill:"#000",d:"M64,124,12,94V34L64,4l52,30V94ZM18.33,90.37,64,116.74l45.67-26.37V37.63L64,11.26,18.33,37.63Z"}),n.createElement("path",{d:"M81.77,43.17c5.92,0,10.51,1.72,13.57,5.16,3.25,3.44,4.77,8.41,4.77,14.71q0,10.32-5.15,16.06c-3.44,3.82-8.22,5.73-14.53,5.73-5.92,0-10.51-1.72-13.56-5.35-3.25-3.63-4.78-8.6-4.78-15.29s1.72-12,5.16-15.67S75.46,43.17,81.77,43.17Zm-.57,5.16c-4.4,0-7.45,1.15-9.56,3.63s-3,6.31-3,11.66c0,5.73,1,9.74,3,12.42,2.11,2.48,5.16,3.82,9.56,3.82s7.64-1.34,9.74-3.82,3.25-6.5,3.25-11.85c0-5.54-1.15-9.55-3.25-12C88.65,49.48,85.59,48.33,81.2,48.33Z",fill:"#fff"}),n.createElement("path",{d:"M39.35,71.45l.19,12.8H33.43L33.62,72l-.19-28.48h6.11l-.19,27.9Z",fill:"#fff"}))};io.propTypes={width:_r.string,height:_r.string};var ao=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},so=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},co=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},uo=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},lo={x:0,y:0,isDragging:!1,startingX:0,startingY:0,currentlyDraggingId:null,currentlyHoveredDroppableId:null,currentlyHoveredDroppableAccepts:null,data:null,type:null},po=new(function(){function e(){ao(this,e),this._state=lo,this._callbacks=[]}return e.prototype.update=function(e){this._state=so({},this._state,e),this._callbacks.forEach(function(e){return e()})},e.prototype.reset=function(){this.update(lo)},e.prototype.subscribe=function(e){var t=this;return this._callbacks=[].concat(this._callbacks,[e]),function(){t._callbacks=t._callbacks.filter(function(t){return t!==e})}},e.prototype.getState=function(){return this._state},e}()),ho=function(){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=0;n<5;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return e},fo=function(){},yo=function(e){function t(){var n,r;ao(this,t);for(var o=arguments.length,i=Array(o),a=0;a<o;a++)i[a]=arguments[a];return n=r=uo(this,e.call.apply(e,[this].concat(i))),r.state=po.getState(),r.shouldComponentUpdate=function(e,t){if(e!==r.props)return!0;if(e.subscribeTo){for(var n=!1,o=0;o<e.subscribeTo.length-1;)r.state[e.subscribeTo[o]]!==t[e.subscribeTo[o]]?(n=!0,o=e.length):o++;return n}return t!==r.state},uo(r,n)}return co(t,e),t.prototype.componentDidMount=function(){var e=this;this.unsubscribe=po.subscribe(function(){e.setState(po.getState())})},t.prototype.componentWillUnmount=function(){this.unsubscribe()},t.prototype.render=function(){var e=this.state,t=e.currentlyHoveredDroppableAccepts,n="string"==typeof e.currentlyHoveredDroppableId;return(this.props.alwaysRender||e.isDragging&&e.currentlyDraggingId===this.props.for)&&this.props.children(so({},e,{isOverAccepted:!!n&&(null===t||(Array.isArray(t)?t.includes(e.type):e.type===t))}))},t}(e.Component);yo.defaultProps={for:"",alwaysRender:!1,subscribeTo:null},yo.propTypes={children:_r.func.isRequired,for:_r.oneOfType([_r.string,_r.number]).isRequired,alwaysRender:_r.bool,subscribeTo:_r.array};var vo=function(e){function t(){var n,r;ao(this,t);for(var o=arguments.length,i=Array(o),a=0;a<o;a++)i[a]=arguments[a];return n=r=uo(this,e.call.apply(e,[this].concat(i))),r.state={startCoordinate:null,storeState:so({},po.getState(),{isActive:!1})},r.startDragDelay=function(e){var t=void 0,n=void 0;"ontouchstart"in window&&e.touches?(t=e.touches[0].clientX,n=e.touches[0].clientY):(e.preventDefault(),t=e.clientX,n=e.clientY),po.update({startingX:t,startingY:n}),r.setState({startCoordinate:{x:t,y:n}}),document.addEventListener("mouseup",r.endDragDelay),document.addEventListener("mousemove",r.checkDragDelay),document.addEventListener("touchend",r.endDragDelay),document.addEventListener("touchmove",r.checkDragDelay)},r.checkDragDelay=function(e){var t=void 0,n=void 0;"ontouchstart"in window&&e.touches?(t=e.touches[0].clientX,n=e.touches[0].clientY):(e.preventDefault(),t=e.clientX,n=e.clientY);var o=Math.abs(r.state.startCoordinate.x-t),i=Math.abs(r.state.startCoordinate.y-n);Math.round(Math.sqrt(Math.pow(o,2)+Math.pow(i,2)))>=r.props.delay&&(r.endDragDelay(),"ontouchstart"in window&&e.touches?r.startMobileDrag(e):r.startDrag(e))},r.endDragDelay=function(){document.removeEventListener("mouseup",r.endDragDelay),document.removeEventListener("mousemove",r.checkDragDelay),document.removeEventListener("touchend",r.endDragDelay),document.removeEventListener("touchmove",r.checkDragDelay),r.setState({startCoordinate:null})},r.startDrag=function(e){po.update({isDragging:!0,startingX:e.clientX,startingY:e.clientY,x:e.clientX,y:e.clientY,currentlyDraggingId:r.props.id,data:r.props.data,type:r.props.type}),r.props.onDragStart(po.getState().data),window.addEventListener("mouseup",r.stopDrag),window.addEventListener("mousemove",r.updateCoordinates)},r.startMobileDrag=function(e){r.props.onDragStart(po.getState().data);var t=e.touches[0];po.update({isDragging:!0,startingX:t.clientX,startingY:t.clientY,x:t.clientX,y:t.clientY,currentlyDraggingId:r.props.id,data:r.props.data,type:r.props.type}),window.addEventListener("touchend",r.stopDrag),window.addEventListener("touchmove",r.updateMobileCoordinates)},r.stopDrag=function(e){r.props.onDragEnd(po.getState().data),po.reset(),window.removeEventListener("mouseup",r.stopDrag),window.removeEventListener("mousemove",r.updateCoordinates),window.removeEventListener("touchend",r.stopDrag),window.removeEventListener("touchmove",r.updateMobileCoordinates)},r.updateCoordinates=function(e){po.update({x:e.clientX,y:e.clientY}),r.props.onDrag()},r.updateMobileCoordinates=function(e){var t=e.touches[0];po.update({x:t.clientX,y:t.clientY}),r.props.onDrag()},r.shouldComponentUpdate=function(e,t){if(e!==r.props)return!0;if(e.subscribeTo){for(var n=!1,o=0;o<e.subscribeTo.length-1;)r.state[e.subscribeTo[o]]!==t[e.subscribeTo[o]]?(n=!0,o=e.length):o++;return n}return t!==r.state},uo(r,n)}return co(t,e),t.prototype.componentDidMount=function(){var e=this;this.unsubscribe=po.subscribe(function(){var t=po.getState();e.setState({storeState:so({},t,{isActive:t.currentlyDraggingId===e.props.id})})})},t.prototype.componentWillUnmount=function(){this.unsubscribe()},t.prototype.render=function(){var e=this.state.storeState;return this.props.children(so({},e,{events:{onMouseDown:this.startDragDelay,onTouchStart:this.startDragDelay}}))},t}(e.Component);vo.defaultProps={id:ho(),data:null,type:null,delay:8,onDragStart:fo,onDrag:fo,onDragEnd:fo,subscribeTo:null},vo.propTypes={children:_r.func.isRequired,delay:_r.number,id:_r.oneOfType([_r.number,_r.string]).isRequired,type:_r.oneOfType([_r.number,_r.string]),onDragStart:_r.func,onDrag:_r.func,onDragEnd:_r.func,subscribeTo:_r.array};var go=function(e){function t(){var n,r;ao(this,t);for(var o=arguments.length,i=Array(o),a=0;a<o;a++)i[a]=arguments[a];return n=r=uo(this,e.call.apply(e,[this].concat(i))),r.state=so({},po.getState(),{isOver:!1}),r.setOver=function(){po.getState().isDragging&&(po.update({currentlyHoveredDroppableId:r.props.id,currentlyHoveredDroppableAccepts:r.props.accepts}),r.props.onDragEnter())},r.setOut=function(){po.getState().isDragging&&(po.update({currentlyHoveredDroppableId:null,currentlyHoveredDroppableAccepts:null}),r.props.onDragLeave())},r.onDrop=function(){var e=po.getState(),t=e.data,n=e.type;e.isDragging&&(Array.isArray(r.props.accepts)?r.props.accepts.includes(n)&&r.props.onDrop(t):n===r.props.accepts&&r.props.onDrop(t))},r.shouldComponentUpdate=function(e,t){if(e!==r.props)return!0;if(e.subscribeTo){for(var n=!1,o=0;o<e.subscribeTo.length-1;)r.state[e.subscribeTo[o]]!==t[e.subscribeTo[o]]?(n=!0,o=e.length):o++;return n}return t!==r.state},uo(r,n)}return co(t,e),t.prototype.componentDidMount=function(){var e=this;this.unsubscribe=po.subscribe(function(){var t=po.getState();e.setState(so({},t,{isOver:t.currentlyHoveredDroppableId===e.props.id,willAccept:Array.isArray(e.props.accepts)?e.props.accepts.includes(t.type):e.props.accepts===t.type}))})},t.prototype.componentWillUnmount=function(){this.unsubscribe()},t.prototype.render=function(){var e=this.state;return this.props.children(so({},e,{events:{onMouseEnter:this.setOver,onMouseLeave:this.setOut,onMouseUp:this.onDrop}}))},t}(e.Component);go.defaultProps={id:ho(),accepts:null,onDragEnter:fo,onDragLeave:fo,onDrop:fo,subscribeTo:null},go.propTypes={id:_r.oneOfType([_r.string,_r.array]),children:_r.func.isRequired,accepts:_r.oneOfType([_r.string,_r.array]),onDrop:_r.func,onDragEnter:_r.func,onDragLeave:_r.func,subscribeTo:_r.array};var mo=function(e){function t(){var n,r;ao(this,t);for(var o=arguments.length,i=Array(o),a=0;a<o;a++)i[a]=arguments[a];return n=r=uo(this,e.call.apply(e,[this].concat(i))),r.state=po.getState(),r.shouldComponentUpdate=function(e,t){if(e!==r.props)return!0;if(e.subscribeTo){for(var n=!1,o=0;o<e.subscribeTo.length-1;)r.state[e.subscribeTo[o]]!==t[e.subscribeTo[o]]?(n=!0,o=e.length):o++;return n}return t!==r.state},uo(r,n)}return co(t,e),t.prototype.componentDidMount=function(){var e=this;this.unsubscribe=po.subscribe(function(){e.setState(po.getState())})},t.prototype.componentWillUnmount=function(){this.unsubscribe()},t.prototype.render=function(){return(0,this.props.children)(so({},this.state))},t}(e.Component);mo.defaultProps={subscribeTo:null},mo.propTypes={children:_r.func.isRequired,subscribeTo:_r.array};Tr("/*\n * Copyright 2017 The boardgame.io Authors\n *\n * Use of this source code is governed by a MIT-style\n * license that can be found in the LICENSE file or at\n * https://opensource.org/licenses/MIT.\n */\n\n.bgio-card {\n  display: flex;\n  user-select: none;\n  font-family: monospace;\n  font-weight: bold;\n  font-size: 18px;\n  color: #ababab;\n  text-align: center;\n  flex-direction: column;\n  justify-content: center;\n  cursor: pointer;\n  background: #fff;\n  border-radius: 6px;\n  border: 1px solid #cdcdcd;\n  width: 100px;\n  height: 140px;\n  overflow: hidden;\n  transition: transform 0.1s;\n}\n\n.bgio-card.placeholder {\n  cursor: default;\n  opacity: 0;\n  pointer-events: none;\n}\n\n.bgio-card.accept {\n  transform: rotate(10deg);\n  box-shadow: 5px 5px 5px #ddd;\n}\n\n.bgio-card.reject {\n}\n\n.bgio-card__front,\n.bgio-card__back {\n  width: 100%;\n  height: 100%;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  overflow: hidden;\n}\n\n.bgio-card__back {\n  background-image: url(\"data:image/svg+xml,%3Csvg width='20' height='20' viewBox='0 0 64 64' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M8 16c4.418 0 8-3.582 8-8s-3.582-8-8-8-8 3.582-8 8 3.582 8 8 8zm0-2c3.314 0 6-2.686 6-6s-2.686-6-6-6-6 2.686-6 6 2.686 6 6 6zm33.414-6l5.95-5.95L45.95.636 40 6.586 34.05.636 32.636 2.05 38.586 8l-5.95 5.95 1.414 1.414L40 9.414l5.95 5.95 1.414-1.414L41.414 8zM40 48c4.418 0 8-3.582 8-8s-3.582-8-8-8-8 3.582-8 8 3.582 8 8 8zm0-2c3.314 0 6-2.686 6-6s-2.686-6-6-6-6 2.686-6 6 2.686 6 6 6zM9.414 40l5.95-5.95-1.414-1.414L8 38.586l-5.95-5.95L.636 34.05 6.586 40l-5.95 5.95 1.414 1.414L8 41.414l5.95 5.95 1.414-1.414L9.414 40z' fill='%23ababab' fill-opacity='0.4' fill-rule='evenodd'/%3E%3C/svg%3E\");\n  background-position: 2px 2px;\n  outline: 8px solid #eee;\n  outline-offset: -20px;\n}\n");var bo=function(e){function t(e){var r;return o(this,t),s(d(d(r=y(this,p(t).call(this,e)))),"onClick",function(){r.props.onClick(r.props.data)}),r.id=e.context.genID(),r.dragComponentRef=n.createRef(),r.isOverAccepted=!1,r}return l(t,n.Component),a(t,[{key:"render",value:function(){var e=this,t=["bgio-card"];this.props.className&&t.push(this.props.className);var r={};return this.props.inDeck&&(r={position:"absolute",zIndex:this.props.deckPosition}),n.createElement("div",null,n.createElement(vo,{id:this.id,type:this.props.dragZone,data:this.props.data},function(e,t,r,o){return function(i){var a=i.isActive,s=i.events;return n.createElement("div",c({className:t.join(" "),style:u({},e.style,r,{opacity:a?0:1,pointerEvents:a?"none":"all"}),onClick:o},s),e.isFaceUp?e.front:e.back)}}(this.props,t,r,this.onClick)),n.createElement(yo,{for:this.id},function(e,t,r,o){return function(i){var a=i.x,s=i.y,c=i.isOverAccepted,u=i.currentlyHoveredDroppableId,l=v(t),p=e.back;return o(c),e.isFaceUp&&(p=e.front),null!==u&&(c?l.push("accept"):l.push("reject")),n.createElement("div",{className:l.join(" "),ref:r,style:{cursor:"pointer",borderWidth:2,pointerEvents:"none",position:"fixed",zIndex:2e9,boxShadow:"5px 5px 5px #eee",left:a-50,top:s-70}},p)}}(this.props,t,this.dragComponentRef,function(t){return e.isOverAccepted=t})))}}]),t}();s(bo,"propTypes",{isFaceUp:_r.bool,front:_r.node,back:_r.node,className:_r.string,dragZone:_r.string,style:_r.any,onClick:_r.func,context:_r.any.isRequired,inDeck:_r.bool,data:_r.any,deckPosition:_r.number}),s(bo,"defaultProps",{onClick:function(){},isFaceUp:!1,dragZone:"bgio-card",front:n.createElement("div",{className:"bgio-card__front"},"Card"),back:n.createElement("div",{className:"bgio-card__back"},n.createElement(io,{width:"48"}))});var wo=function(e){return n.createElement(to.Consumer,null,function(t){return n.createElement(bo,c({},e,{context:t}))})},ko=G(function(e,t){var n=function(){this._tweens={},this._tweensAddedDuringUpdate={}};n.prototype={getAll:function(){return Object.keys(this._tweens).map(function(e){return this._tweens[e]}.bind(this))},removeAll:function(){this._tweens={}},add:function(e){this._tweens[e.getId()]=e,this._tweensAddedDuringUpdate[e.getId()]=e},remove:function(e){delete this._tweens[e.getId()],delete this._tweensAddedDuringUpdate[e.getId()]},update:function(e,t){var n=Object.keys(this._tweens);if(0===n.length)return!1;for(e=void 0!==e?e:o.now();n.length>0;){this._tweensAddedDuringUpdate={};for(var r=0;r<n.length;r++){var i=this._tweens[n[r]];i&&!1===i.update(e)&&(i._isPlaying=!1,t||delete this._tweens[n[r]])}n=Object.keys(this._tweensAddedDuringUpdate)}return!0}};var r,o=new n;o.Group=n,o._nextId=0,o.nextId=function(){return o._nextId++},"undefined"==typeof window&&"undefined"!=typeof process?o.now=function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?o.now=window.performance.now.bind(window.performance):void 0!==Date.now?o.now=Date.now:o.now=function(){return(new Date).getTime()},o.Tween=function(e,t){this._object=e,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._repeat=0,this._repeatDelayTime=void 0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=null,this._easingFunction=o.Easing.Linear.None,this._interpolationFunction=o.Interpolation.Linear,this._chainedTweens=[],this._onStartCallback=null,this._onStartCallbackFired=!1,this._onUpdateCallback=null,this._onCompleteCallback=null,this._onStopCallback=null,this._group=t||o,this._id=o.nextId()},o.Tween.prototype={getId:function(){return this._id},isPlaying:function(){return this._isPlaying},to:function(e,t){return this._valuesEnd=e,void 0!==t&&(this._duration=t),this},start:function(e){for(var t in this._group.add(this),this._isPlaying=!0,this._onStartCallbackFired=!1,this._startTime=void 0!==e?"string"==typeof e?o.now()+parseFloat(e):e:o.now(),this._startTime+=this._delayTime,this._valuesEnd){if(this._valuesEnd[t]instanceof Array){if(0===this._valuesEnd[t].length)continue;this._valuesEnd[t]=[this._object[t]].concat(this._valuesEnd[t])}void 0!==this._object[t]&&(this._valuesStart[t]=this._object[t],this._valuesStart[t]instanceof Array==!1&&(this._valuesStart[t]*=1),this._valuesStartRepeat[t]=this._valuesStart[t]||0)}return this},stop:function(){return this._isPlaying?(this._group.remove(this),this._isPlaying=!1,null!==this._onStopCallback&&this._onStopCallback(this._object),this.stopChainedTweens(),this):this},end:function(){return this.update(this._startTime+this._duration),this},stopChainedTweens:function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop()},group:function(e){return this._group=e,this},delay:function(e){return this._delayTime=e,this},repeat:function(e){return this._repeat=e,this},repeatDelay:function(e){return this._repeatDelayTime=e,this},yoyo:function(e){return this._yoyo=e,this},easing:function(e){return this._easingFunction=e,this},interpolation:function(e){return this._interpolationFunction=e,this},chain:function(){return this._chainedTweens=arguments,this},onStart:function(e){return this._onStartCallback=e,this},onUpdate:function(e){return this._onUpdateCallback=e,this},onComplete:function(e){return this._onCompleteCallback=e,this},onStop:function(e){return this._onStopCallback=e,this},update:function(e){var t,n,r;if(e<this._startTime)return!0;for(t in!1===this._onStartCallbackFired&&(null!==this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),n=(e-this._startTime)/this._duration,n=0===this._duration||n>1?1:n,r=this._easingFunction(n),this._valuesEnd)if(void 0!==this._valuesStart[t]){var o=this._valuesStart[t]||0,i=this._valuesEnd[t];i instanceof Array?this._object[t]=this._interpolationFunction(i,r):("string"==typeof i&&(i="+"===i.charAt(0)||"-"===i.charAt(0)?o+parseFloat(i):parseFloat(i)),"number"==typeof i&&(this._object[t]=o+(i-o)*r))}if(null!==this._onUpdateCallback&&this._onUpdateCallback(this._object),1===n){if(this._repeat>0){for(t in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat){if("string"==typeof this._valuesEnd[t]&&(this._valuesStartRepeat[t]=this._valuesStartRepeat[t]+parseFloat(this._valuesEnd[t])),this._yoyo){var a=this._valuesStartRepeat[t];this._valuesStartRepeat[t]=this._valuesEnd[t],this._valuesEnd[t]=a}this._valuesStart[t]=this._valuesStartRepeat[t]}return this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=e+this._repeatDelayTime:this._startTime=e+this._delayTime,!0}null!==this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var s=0,c=this._chainedTweens.length;s<c;s++)this._chainedTweens[s].start(this._startTime+this._duration);return!1}return!0}},o.Easing={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){return 0===e?0:1===e?1:-Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)},Out:function(e){return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin(5*(e-.1)*Math.PI)+1},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?-.5*Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)+1}},Back:{In:function(e){var t=1.70158;return e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:function(e){return 1-o.Easing.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?.5*o.Easing.Bounce.In(2*e):.5*o.Easing.Bounce.Out(2*e-1)+.5}}},o.Interpolation={Linear:function(e,t){var n=e.length-1,r=n*t,i=Math.floor(r),a=o.Interpolation.Utils.Linear;return t<0?a(e[0],e[1],r):t>1?a(e[n],e[n-1],n-r):a(e[i],e[i+1>n?n:i+1],r-i)},Bezier:function(e,t){for(var n=0,r=e.length-1,i=Math.pow,a=o.Interpolation.Utils.Bernstein,s=0;s<=r;s++)n+=i(1-t,r-s)*i(t,s)*e[s]*a(r,s);return n},CatmullRom:function(e,t){var n=e.length-1,r=n*t,i=Math.floor(r),a=o.Interpolation.Utils.CatmullRom;return e[0]===e[n]?(t<0&&(i=Math.floor(r=n*(1+t))),a(e[(i-1+n)%n],e[i],e[(i+1)%n],e[(i+2)%n],r-i)):t<0?e[0]-(a(e[0],e[0],e[1],e[1],-r)-e[0]):t>1?e[n]-(a(e[n],e[n],e[n-1],e[n-1],r-n)-e[n]):a(e[i?i-1:0],e[i],e[n<i+1?n:i+1],e[n<i+2?n:i+2],r-i)},Utils:{Linear:function(e,t,n){return(t-e)*n+e},Bernstein:function(e,t){var n=o.Interpolation.Utils.Factorial;return n(e)/n(t)/n(e-t)},Factorial:(r=[1],function(e){var t=1;if(r[e])return r[e];for(var n=e;n>1;n--)t*=n;return r[e]=t,t}),CatmullRom:function(e,t,n,r,o){var i=.5*(n-e),a=.5*(r-t),s=o*o;return(2*t-2*n+i+a)*(o*s)+(-3*t+3*n-2*i-a)*s+i*o+t}}},e.exports=o}),xo=function(e){function r(e){var n;o(this,r),s(d(d(n=y(this,p(r).call(this,e)))),"onEvent",function(e){n.props.responsive&&("dragStart"==e.type&&(n.obj.castShadow=!0,new ko.Tween(n.obj.position).to({y:n.originalY+.5},100).easing(ko.Easing.Quadratic.Out).start()),"dragEnd"==e.type&&new ko.Tween(n.obj.position).to({y:n.originalY},100).onComplete(function(){return n.obj.castShadow=!1}).start(),"drag"==e.type&&(n.obj.position.x=e.point.x,n.obj.position.z=e.point.z))}),n.originalY=e.thickness/2-1e-4;var i=new t.BoxGeometry(e.width,e.thickness,e.height),a={color:7829367};e.image&&(a={map:(new t.TextureLoader).load(e.image)});var c=new t.MeshLambertMaterial(a);return n.obj=new t.Mesh(i,c),n.obj.receiveShadow=!0,n.obj.position.y=n.originalY,n.obj.userData.draggable=e.draggable,n.obj.userData.responsive=e.responsive,n}return l(r,n.Component),a(r,[{key:"componentDidMount",value:function(){this.props.context.add(this.obj,this.onEvent)}},{key:"componentWillUnmount",value:function(){this.props.context.remove(this.obj)}},{key:"render",value:function(){return this.obj.position.x=this.props.x+this.props.splayX,this.obj.position.z=this.props.z+this.props.splayZ,this.obj.position.y=this.originalY+this.props.splayY,null}}]),r}();s(xo,"propTypes",{context:_r.any.isRequired,image:_r.string,width:_r.number,height:_r.number,thickness:_r.number,responsive:_r.bool,draggable:_r.bool,x:_r.number,z:_r.number,splayX:_r.number,splayY:_r.number,splayZ:_r.number}),s(xo,"defaultProps",{responsive:!0,draggable:!0,splayX:0,splayY:0,splayZ:0,x:0,z:0,width:1,height:1.5,thickness:.01});var Co=function(e){return n.createElement(to.Consumer,null,function(t){return n.createElement(xo,c({},e,{context:t}))})},Do=function(e){return n.createElement(to.Consumer,null,function(t){return t.three?n.createElement(Co,c({},e,{context:t})):n.createElement(wo,c({},e,{context:t}))})};Do.propTypes={children:_r.any};var Eo=function(e){return n.createElement(to.Consumer,null,function(t){return n.createElement(Oo,c({},e,{context:t}))})},Oo=function(e){function r(e){var n;return o(this,r),(n=y(this,p(r).call(this,e))).boardGroup=new t.Group,n.tokenGroup=new t.Group,n.boardGroup.add(n.tokenGroup),n.boardGroup.translateX(-(n.props.padding+n.props.cellSize)*(n.props.cols-1)/2),n.boardGroup.translateZ(-(n.props.padding+n.props.cellSize)*(n.props.rows-1)/2),n}return l(r,n.Component),a(r,[{key:"_getCellColor",value:function(e,t){var n="".concat(e,",").concat(t),r="#777777";return n in this.props.colorMap&&(r=this.props.colorMap[n]),r}},{key:"componentWillUnmount",value:function(){this.context.remove(this.boardGroup)}},{key:"render",value:function(){var e=this;this.context=this.props.context,this.context.add(this.boardGroup),this.boardGroup.remove(this.squareGroup),this.squareGroup=new t.Group,this.boardGroup.add(this.squareGroup);for(var r=function(t){for(var n=function(n){var r={x:t,y:n,size:e.props.cellSize,color:e._getCellColor(t,n),padding:e.props.padding,thickness:e.props.thickness},o=new Po(r);e.squareGroup.add(o);e.context.regCall(o,function(r){"click"==r.type?e.props.onClick&&e.props.onClick({x:t,y:n}):"mouseOver"==r.type?e.props.onMouseOver&&e.props.onMouseOver({x:t,y:n}):"mouseOut"==r.type&&e.props.onMouseOut&&e.props.onMouseOut({x:t,y:n})})},r=0;r<e.props.rows;r++)n(r)},o=0;o<this.props.cols;o++)r(o);var i=n.Children.map(this.props.children,function(t){return n.cloneElement(t,{three:!0,boardSize:e.props.cellSize,parent:e.tokenGroup,padding:e.props.padding,lift:e.props.thickness})});return i||null}}]),r}();s(Oo,"propTypes",{rows:_r.number.isRequired,cols:_r.number.isRequired,cellSize:_r.number,thickness:_r.number,padding:_r.number,colorMap:_r.object,onClick:_r.func,onMouseOver:_r.func,onMouseOut:_r.func,context:_r.any,children:_r.oneOfType([_r.arrayOf(_r.element),_r.element])}),s(Oo,"defaultProps",{colorMap:{},cellSize:1,padding:.1,thickness:.1});var Po=function(e){function n(e){var r;return o(this,n),(r=y(this,p(n).call(this))).userData=u({responsive:!0,draggable:!1},e),e=r.userData,r.geometry=new t.BoxBufferGeometry(e.size,e.thickness,e.size),r.material=new t.MeshLambertMaterial({color:e.color}),r.receiveShadow=!0,r.translateX(r.userData.x*(e.size+e.padding)),r.translateZ(r.userData.y*(e.size+e.padding)),r.translateY(r.userData.thickness/2),r}return l(n,t.Mesh),n}(),Io=function(e){return e.three?n.createElement(Eo,e,e.children):n.createElement(Zr,e,e.children)};Io.propTypes={three:_r.bool,children:_r.any};_r.bool,_r.any;var _o=function(e){function t(){var e,r;o(this,t);for(var i=arguments.length,a=new Array(i),c=0;c<i;c++)a[c]=arguments[c];return s(d(d(r=y(this,(e=p(t)).call.apply(e,[this].concat(a))))),"_svgRef",n.createRef()),s(d(d(r)),"onClick",function(e){r.props.onClick&&r.props.onClick(e)}),s(d(d(r)),"onMouseOver",function(e){r.props.onMouseOver&&r.props.onMouseOver(e)}),s(d(d(r)),"onMouseOut",function(e){r.props.onMouseOut&&r.props.onMouseOut(e)}),r}return l(t,n.Component),a(t,[{key:"_getCellColor",value:function(e,t,n){var r="".concat(e,",").concat(t,",").concat(n),o="white";return r in this.props.colorMap&&(o=this.props.colorMap[r]),o}},{key:"_getGrid",value:function(){if(!this.props.outline)return null;for(var e=[],t=this.props.levels,r=-t;r<=t;r++)for(var o=-t;o<=t;o++){var i=-r-o;Math.abs(i)>t||e.push(n.createElement(Mo,{key:"".concat(r,":").concat(o,":").concat(i),style:{fill:this._getCellColor(r,o,i)},x:r,y:o,z:i,size:this.props.cellSize,onClick:this.onClick,onMouseOver:this.onMouseOver,onMouseOut:this.onMouseOut}))}return e}},{key:"render",value:function(){var e=this,t=n.Children.map(this.props.children,function(t){return n.cloneElement(t,{template:Mo,onClick:e.onClick,onMouseOver:e.onMouseOver,onMouseOut:e.onMouseOut,svgRef:e._svgRef})}),r=this.props.cellSize*this.props.levels*2;return n.createElement("svg",{ref:this._svgRef,viewBox:-r+" "+-r+" "+2*r+" "+2*r,style:this.props.style},n.createElement("g",null,this._getGrid()),t)}}]),t}();s(_o,"propTypes",{levels:_r.number.isRequired,outline:_r.bool,style:_r.object,colorMap:_r.object,cellSize:_r.number,onClick:_r.func,onMouseOver:_r.func,onMouseOut:_r.func,children:_r.oneOfType([_r.arrayOf(_r.element),_r.element])}),s(_o,"defaultProps",{levels:5,colorMap:{},outline:!0,cellSize:1});var Mo=function(e){function t(e){var r;return o(this,t),s(d(d(r=y(this,p(t).call(this,e)))),"_gRef",n.createRef()),s(d(d(r)),"onClick",function(e){r.props.onClick(r.getCoords(),e)}),s(d(d(r)),"onMouseOver",function(e){r.props.onMouseOver(r.getCoords(),e)}),s(d(d(r)),"onMouseOut",function(e){r.props.onMouseOut(r.getCoords(),e)}),r}return l(t,n.Component),a(t,[{key:"componentDidMount",value:function(){var e=this._gRef.current,t=!0,n=!1,r=void 0;try{for(var o,i=this.props.eventListeners[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var a=o.value;e.addEventListener(a.name,a.callback)}}catch(e){n=!0,r=e}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}}},{key:"componentWillUnmount",value:function(){var e=this._gRef.current,t=!0,n=!1,r=void 0;try{for(var o,i=this.props.eventListeners[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var a=o.value;e.removeEventListener(a.name,a.callback)}}catch(e){n=!0,r=e}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}}},{key:"getCoords",value:function(){return{x:this.props.x,y:this.props.y,z:this.props.z}}},{key:"render",value:function(){var e=this.center.x,t=this.center.y,r=n.createElement("polygon",{style:this.props.style,points:this.points,stroke:"#aaa",strokeWidth:.01});return this.props.children&&(r=this.props.children),n.createElement("g",{ref:this._gRef,onClick:this.onClick,onMouseOver:this.onMouseOver,onMouseOut:this.onMouseOut,transform:"translate(".concat(e,", ").concat(t,")")},r)}},{key:"width",get:function(){return 2*this.props.size}},{key:"height",get:function(){return(Math.sqrt(3)/2*this.width).toFixed(3)}},{key:"center",get:function(){var e=this.props.x,t=this.props.z;return{x:3*this.props.size*e/2,y:this.props.size*Math.sqrt(3)*(t+e/2)}}},{key:"points",get:function(){var e=this.props.size,t=this.height,n=-e/2,r=+e/2,o=+e,i=r,a=n,s=t/2,c=s,u=-t/2,l=u;return["".concat(-e,",").concat(0),"".concat(n,",").concat(s),"".concat(r,",").concat(c),"".concat(o,",").concat(0),"".concat(i,",").concat(u),"".concat(a,",").concat(l)].join(" ")}}]),t}();s(Mo,"propTypes",{x:_r.number,y:_r.number,z:_r.number,size:_r.number,style:_r.any,onClick:_r.func,onMouseOver:_r.func,onMouseOut:_r.func,eventListeners:_r.array,children:_r.element}),s(Mo,"defaultProps",{size:1,x:0,y:0,z:0,style:{fill:"#fff"},eventListeners:[]});var So=function(e){function t(){return o(this,t),y(this,p(t).apply(this,arguments))}return l(t,n.Component),a(t,[{key:"render",value:function(){return null}}]),t}();_r.bool,_r.any;var Ao=function(e){return e.three?n.createElement(So,e,e.children):n.createElement(_o,e,e.children)};Ao.propTypes={three:_r.bool,children:_r.any};var To=function(){function e(t){var n=this,r=t.enumerate,i=t.seed;o(this,e),s(this,"enumerate",function(e,t,r){return n.enumerateFn(e,t,r).map(function(e){return void 0!==e.payload?e:void 0!==e.move?A(e.move,e.args,r):void 0!==e.event?T(e.event,e.args,r):void 0})}),this.enumerateFn=r,this.seed=i}return a(e,[{key:"random",value:function(e){var t;if(void 0!==this.seed){var n=null;t=(n=this.prngstate?new sn("",{state:this.prngstate}):new sn(this.seed,{state:!0}))(),this.prngstate=n.state()}else t=Math.random();return e?e.length?e[Math.floor(t*e.length)]:Math.floor(t*e):t}}]),e}(),jo=function(e){function t(){return o(this,t),y(this,p(t).apply(this,arguments))}return l(t,To),a(t,[{key:"play",value:function(e,t){var n=e.G,r=e.ctx,o=this.enumerate(n,r,t);return{action:this.random(o)}}}]),t}(),Ro=function(e){function t(e){var n,r=e.enumerate,i=e.seed,a=e.objectives,s=e.game,c=e.iterations,u=e.playoutDepth;return o(this,t),void 0===a&&(a=function(){return{}}),(n=y(this,p(t).call(this,{enumerate:r,seed:i}))).objectives=a,n.reducer=cr({game:s}),n.iterations=c||1e3,n.playoutDepth=u||50,n}return l(t,To),a(t,[{key:"createNode",value:function(e){var t=e.state,n=e.parentAction,r=e.parent,o=e.playerID,i=t.G,a=t.ctx,s=[],c=[];if(void 0!==o)s=this.enumerate(i,a,o),c=this.objectives(i,a,o);else{var u=!0,l=!1,p=void 0;try{for(var h,f=a.actionPlayers[Symbol.iterator]();!(u=(h=f.next()).done);u=!0){var d=h.value;s=s.concat(this.enumerate(i,a,d)),c=c.concat(this.objectives(i,a,d))}}catch(e){l=!0,p=e}finally{try{u||null==f.return||f.return()}finally{if(l)throw p}}}return{state:t,parent:r,parentAction:n,actions:s,objectives:c,children:[],visits:0,value:0}}},{key:"select",value:function(e){if(e.actions.length>0)return e;if(0==e.children.length)return e;var t=null,n=0,r=!0,o=!1,i=void 0;try{for(var a,s=e.children[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var c=a.value,u=c.visits+Number.EPSILON,l=c.value/u+Math.sqrt(2*Math.log(e.visits)/u);(null==t||l>n)&&(n=l,t=c)}}catch(e){o=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return this.select(t)}},{key:"expand",value:function(e){var t=e.actions;if(0==t.length||void 0!==e.state.ctx.gameover)return e;var n=this.random(t.length),r=t[n];e.actions.splice(n,1);var o=this.reducer(e.state,r),i=this.createNode({state:o,parentAction:r,parent:e});return e.children.push(i),i}},{key:"playout",value:function(e){for(var t=this,n=e.state,o=function(e){var r=n,o=r.G,i=r.ctx,a=t.enumerate(o,i,i.actionPlayers[0]),s=t.objectives(o,i),c=Object.keys(s).reduce(function(e,t){var n=s[t];return n.checker(o,i)?e+n.weight:e},0);if(c>0)return{v:{score:c}};if(!a||0==a.length)return{v:void 0};var u=t.random(a.length),l=t.reducer(n,a[u]);n=l},i=0;i<this.playoutDepth&&void 0===n.ctx.gameover;i++){var a=o();if("object"===r(a))return a.v}return n.ctx.gameover}},{key:"backpropagate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e.visits++,void 0!==t.score&&(e.value+=t.score),!0===t.draw&&(e.value+=.5),e.parentAction&&t.winner===e.parentAction.payload.playerID&&e.value++,e.parent&&this.backpropagate(e.parent,t)}},{key:"play",value:function(e,t){for(var n=this.createNode({state:e,playerID:t}),r=0;r<this.iterations;r++){var o=this.select(n),i=this.expand(o),a=this.playout(i);this.backpropagate(i,a)}var s=null,c=!0,u=!1,l=void 0;try{for(var p,h=n.children[Symbol.iterator]();!(c=(p=h.next()).done);c=!0){var f=p.value;(null==s||f.visits>s.visits)&&(s=f)}}catch(e){u=!0,l=e}finally{try{c||null==h.return||h.return()}finally{if(u)throw l}}return{action:s&&s.parentAction,metadata:n}}}]),t}();return{Client:wr,ReactClient:function(e){var t,i,c=e.game,h=e.numPlayers,v=e.loading,g=e.board,m=e.multiplayer,b=e.ai,w=e.debug,k=e.enhancer;void 0===v&&(v=function(){return n.createElement("div",{className:"bgio-loading"},"connecting...")});return i=t=function(e){function t(e){var n;return o(this,t),s(d(d(n=y(this,p(t).call(this,e)))),"state",{gameStateOverride:null}),s(d(d(n)),"updateGameID",function(e){n.client.updateGameID(e),n.gameID=e,n.forceUpdate()}),s(d(d(n)),"updatePlayerID",function(e){n.client.updatePlayerID(e),n.playerID=e,n.forceUpdate()}),s(d(d(n)),"updateCredentials",function(e){n.client.updateCredentials(e),n.credentials=e,n.forceUpdate()}),s(d(d(n)),"overrideGameState",function(e){n.setState({gameStateOverride:e})}),n.client=wr({game:c,ai:b,numPlayers:h,multiplayer:m,gameID:e.gameID,playerID:e.playerID,credentials:e.credentials,enhancer:k}),n.gameID=e.gameID,n.playerID=e.playerID,n.credentials=e.credentials,n.client.subscribe(function(){return n.forceUpdate()}),n}return l(t,n.Component),a(t,[{key:"componentDidUpdate",value:function(e){this.props.gameID!=e.gameID&&this.updateGameID(this.props.gameID),this.props.playerID!=e.playerID&&this.updatePlayerID(this.props.playerID),this.props.credentials!=e.credentials&&this.updateCredentials(this.props.credentials)}},{key:"componentDidMount",value:function(){this.client.connect()}},{key:"render",value:function(){var e=null,t=null,o=this.client.getState(),i=this.props,a=i.debug,s=f(i,["debug"]);if(this.state.gameStateOverride&&(o=u({},o,this.state.gameStateOverride)),null===o)return n.createElement(v);if(g&&(e=n.createElement(g,u({},o,s,{isMultiplayer:void 0!==m,moves:this.client.moves,events:this.client.events,gameID:this.gameID,playerID:this.playerID,step:this.client.step,reset:this.client.reset,undo:this.client.undo,redo:this.client.redo}))),!1!==w&&a){var c="object"===r(w)&&w.showGameInfo,l="object"===r(w)&&w.dockControls;t=n.createElement(Hr,{gamestate:o,reducer:this.client.reducer,store:this.client.store,isMultiplayer:void 0!==m,moves:this.client.moves,events:this.client.events,gameID:this.gameID,playerID:this.playerID,credentials:this.credentials,step:this.client.step,reset:this.client.reset,undo:this.client.undo,redo:this.client.redo,visualizeAI:b&&b.visualize,overrideGameState:this.overrideGameState,updateGameID:this.updateGameID,updatePlayerID:this.updatePlayerID,updateCredentials:this.updateCredentials,showGameInfo:c,dockControls:l})}return n.createElement("div",{className:"bgio-client"},t,e)}}]),t}(),s(t,"propTypes",{gameID:_r.string,playerID:_r.string,credentials:_r.string,debug:_r.any}),s(t,"defaultProps",{gameID:"default",playerID:null,credentials:null,debug:!0}),i},ReactNativeClient:function(e){var t,r,i=e.game,c=e.numPlayers,h=e.board,d=e.multiplayer,v=e.enhancer;return r=t=function(e){function t(e){var n;return o(this,t),(n=y(this,p(t).call(this,e))).client=wr({game:i,numPlayers:c,multiplayer:d,gameID:e.gameID,playerID:e.playerID,credentials:e.credentials,socketOpts:{transports:["websocket"]},enhancer:v}),n.client.subscribe(function(){return n.forceUpdate()}),n}return l(t,n.Component),a(t,[{key:"componentWillReceiveProps",value:function(e){e.gameID!=this.props.gameID&&this.client.updateGameID(e.gameID),e.playerID!=this.props.playerID&&this.client.updatePlayerID(e.playerID),e.credentials!=this.props.credentials&&this.client.updateCredentials(e.credentials)}},{key:"componentWillMount",value:function(){this.client.connect()}},{key:"render",value:function(){var e=null,t=this.client.getState(),r=this.props,o=r.gameID,i=r.playerID,a=f(r,["gameID","playerID"]);return h&&(e=n.createElement(h,u({},t,a,{gameID:o,playerID:i,isMultiplayer:void 0!==d,moves:this.client.moves,events:this.client.events,step:this.client.step,reset:this.client.reset,undo:this.client.undo,redo:this.client.redo}))),e}}]),t}(),s(t,"propTypes",{gameID:_r.string,playerID:_r.string,credentials:_r.string}),s(t,"defaultProps",{gameID:"default",playerID:null,credentials:null}),r},Game:function(e){return void 0===e.name&&(e.name="default"),void 0===e.setup&&(e.setup=function(){return{}}),void 0===e.moves&&(e.moves={}),void 0===e.playerView&&(e.playerView=function(e){return e}),void 0===e.plugins&&(e.plugins=[]),e.flow&&void 0!==e.flow.processGameEvent||(e.flow=Jr(u({game:e},e.flow))),u({},e,{moveNames:Object.getOwnPropertyNames(e.moves),processMove:function(t,n,r){if(e.moves.hasOwnProperty(n.type)){var o=[t,u({},r,{playerID:n.playerID})].concat(n.args);return tr(e.moves[n.type],e).apply(void 0,v(o))}return t}})},Flow:$r,FlowWithPhases:Jr,TurnOrder:Vr,Pass:function(e,t){var n=[];void 0!==e.passOrder&&(n=e.passOrder);var r=t.playerID;return e=u({},e,{passOrder:n=[].concat(v(n),[r])}),n.length>=t.numPlayers&&(e=u({},e,{allPassed:!0})),e},Card:Do,Token:oo,Grid:Io,HexGrid:Ao,AI:function(e){var t=e.bot,n=e.enumerate,r=e.visualize;return t||(t=Ro),{bot:t,enumerate:n,visualize:r}},RandomBot:jo,MCTSBot:Ro}});
